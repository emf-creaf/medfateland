### `r paste0(toupper(watershed), " watershed with ", toupper(model), " and version ", medfateland_version)`

#### Graphical evaluation

*Daily*
```{r, echo = FALSE, fig = TRUE, fig.width=8, fig.height = 3, warning=FALSE}
ggplot(Q_daily, aes(x=Date))+
  geom_line(aes(y = Qobs), col = "black", linewidth = 0.8)+
  geom_line(aes(y = Qunc), col = "red")+
  geom_line(aes(y = Qcal), col = "blue")+
  scale_y_continuous("Q (m3/s)")+
  theme_bw()
```

*Monthly*
```{r, echo = FALSE, fig = TRUE, fig.width=8, fig.height = 3, warning=FALSE}
ggplot(Q_monthly, aes(x=Date))+
  geom_line(aes(y = Qobs), col = "black", linewidth = 0.8)+
  geom_line(aes(y = Qunc), col = "red")+
  geom_line(aes(y = Qcal), col = "blue")+
  scale_y_continuous("Q (m3/s)")+
  theme_bw()
```

#### Goodness-of-fit 


```{r, echo = FALSE}
# Daily NSE
nse_daily_unc<-hydroGOF::NSE(Q_daily$Qunc,Q_daily$Qobs,na.rm=TRUE)
nse_daily_cal<-hydroGOF::NSE(Q_daily$Qcal,Q_daily$Qobs,na.rm=TRUE)

# Monthly NSE
nse_monthly_unc<-hydroGOF::NSE(Q_monthly$Qunc,Q_monthly$Qobs,na.rm=TRUE)
nse_monthly_cal<-hydroGOF::NSE(Q_monthly$Qcal,Q_monthly$Qobs,na.rm=TRUE)

# Daily KGE
KGE_daily_unc<-hydroGOF::KGE(Q_daily$Qunc,Q_daily$Qobs, s=c(1,1,1), na.rm=TRUE, method=c("2021"), 
                             out.type=c("full"), fun=NULL, 
                             epsilon.type=c("none"), 
                             epsilon.value=NA)
KGE_daily_cal<-hydroGOF::KGE(Q_daily$Qcal,Q_daily$Qobs, s=c(1,1,1), na.rm=TRUE, method=c("2021"), 
                             out.type=c("full"), fun=NULL, 
                             epsilon.type=c("none"), 
                             epsilon.value=NA)

# Monthly KGE
KGE_monthly_unc<-hydroGOF::KGE(Q_monthly$Qunc,Q_monthly$Qobs, s=c(1,1,1), na.rm=TRUE, method=c("2021"), 
                             out.type=c("full"), fun=NULL, 
                             epsilon.type=c("none"), 
                             epsilon.value=NA)
KGE_monthly_cal<-hydroGOF::KGE(Q_monthly$Qcal,Q_monthly$Qobs, s=c(1,1,1), na.rm=TRUE, method=c("2021"), 
                             out.type=c("full"), fun=NULL, 
                             epsilon.type=c("none"), 
                             epsilon.value=NA)

# Index of agreement
d_daily_unc<-hydroGOF::dr(Q_daily$Qunc,Q_daily$Qobs, na.rm = TRUE)
d_daily_cal<-hydroGOF::dr(Q_daily$Qcal,Q_daily$Qobs, na.rm = TRUE)

d_monthly_unc<-hydroGOF::dr(Q_monthly$Qunc,Q_monthly$Qobs, na.rm = TRUE)
d_monthly_cal<-hydroGOF::dr(Q_monthly$Qcal,Q_monthly$Qobs, na.rm = TRUE)

# Volumetric efficiency
ve_daily_unc<-hydroGOF::VE(Q_daily$Qunc,Q_daily$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)
ve_daily_cal<-hydroGOF::VE(Q_daily$Qcal,Q_daily$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)

ve_monthly_unc<-hydroGOF::VE(Q_monthly$Qunc,Q_monthly$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)
ve_monthly_cal<-hydroGOF::VE(Q_monthly$Qcal,Q_monthly$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)

# RMSE
rmse_daily_unc<-hydroGOF::rmse(Q_daily$Qunc,Q_daily$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)
rmse_daily_cal<-hydroGOF::rmse(Q_daily$Qcal,Q_daily$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)
rmse_monthly_unc<-hydroGOF::rmse(Q_monthly$Qunc,Q_monthly$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)
rmse_monthly_cal<-hydroGOF::rmse(Q_monthly$Qcal,Q_monthly$Qobs, na.rm=TRUE, fun=NULL,
                       epsilon.type=c("none"), epsilon.value=NA)
```


```{r, echo = FALSE}

validation_coefficients<- data.frame(Scale = c("Daily", "Daily", "Monthly", "Monthly"),
                                     Calibration =  c("Before","After","Before","After"),
                                     NSE = NA,
                                     KGE = NA,
                                     d = NA,
                                     VE = NA,
                                     RMSE = NA)

validation_coefficients$NSE[1]<-nse_daily_unc
validation_coefficients$NSE[2]<-nse_daily_cal
validation_coefficients$NSE[3]<-nse_monthly_unc
validation_coefficients$NSE[4]<-nse_monthly_cal

validation_coefficients$KGE[1]<-KGE_daily_unc[["KGE.value"]]
validation_coefficients$KGE[2]<-KGE_daily_cal[["KGE.value"]]
validation_coefficients$KGE[3]<-KGE_monthly_unc[["KGE.value"]]
validation_coefficients$KGE[4]<-KGE_monthly_cal[["KGE.value"]]

validation_coefficients$d[1]<-d_daily_unc
validation_coefficients$d[2]<-d_daily_cal
validation_coefficients$d[3]<-d_monthly_unc
validation_coefficients$d[4]<-d_monthly_cal

validation_coefficients$VE[1]<-ve_daily_unc
validation_coefficients$VE[2]<-ve_daily_cal
validation_coefficients$VE[3]<-ve_monthly_unc
validation_coefficients$VE[4]<-ve_monthly_cal

validation_coefficients$RMSE[1]<-rmse_daily_unc
validation_coefficients$RMSE[2]<-rmse_daily_cal
validation_coefficients$RMSE[3]<-rmse_monthly_unc
validation_coefficients$RMSE[4]<-rmse_monthly_cal

validation_coefficients |> 
  kbl() |>
  kable_styling()
```


#### Hydrological analysis

