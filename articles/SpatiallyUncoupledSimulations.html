<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatially-uncoupled simulations • medfateland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatially-uncoupled simulations">
<meta property="og:description" content="medfateland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatially-uncoupled simulations</h1>
                        <h4 data-toc-skip class="author">Miquel De
Caceres</h4>
            
            <h4 data-toc-skip class="date">2024-05-08</h4>
      
      
      <div class="hidden name"><code>SpatiallyUncoupledSimulations.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="aim">Aim<a class="anchor" aria-label="anchor" href="#aim"></a>
</h2>
<p>The aim of this vignette is to illustrate how to use
<strong>medfateland</strong> (v. 2.3.0) to carry out simulations of
forest function and dynamics on a set of spatial units, without taking
into account spatial processes. This is done using functions
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>, <code><a href="../reference/spwb_spatial.html">growth_spatial()</a></code> and
<code><a href="../reference/spwb_spatial.html">fordyn_spatial()</a></code>; which are counterparts of functions
<code>spwb()</code>, <code>growth()</code> and <code>fordyn()</code> in
package <strong>medfate</strong>. As an example, we will use function
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>, but the other two functions would be used
similarly.</p>
</div>
<div class="section level2">
<h2 id="preparation">Preparation<a class="anchor" aria-label="anchor" href="#preparation"></a>
</h2>
<div class="section level3">
<h3 id="input-structures">Input structures<a class="anchor" aria-label="anchor" href="#input-structures"></a>
</h3>
<p>The fundamental input structure in <strong>medfateland</strong> is an
object of class <strong>sf</strong>, i.e. a simple feature collection
where geometries (normally points) are described with attributes. In the
case of <strong>medfateland</strong>, spatial attributes correspond to
model inputs for each of the spatial units represented. We begin by
loading an example data set of 100 forest stands distributed on points
in the landscape:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"example_ifn"</span><span class="op">)</span></span>
<span><span class="va">example_ifn</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 100 features and 7 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.817095 ymin: 41.93301 xmax: 2.142956 ymax: 41.99881</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 100 × 8</span></span></span>
<span><span class="co">##                   geom id        elevation slope aspect land_cover_type soil  </span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span>         <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (2.130641 41.99872) 081015_A1       680  7.73  281.  wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (2.142714 41.99881) 081016_A1       736 15.6   212.  wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (1.828998 41.98704) 081018_A1       532 17.6   291.  wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (1.841068 41.98716) 081019_A1       581  4.79  174.  wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (1.853138 41.98728) 081020_A1       613  4.76   36.9 wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (1.901418 41.98775) 081021_A1       617 10.6   253.  wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (1.937629 41.98809) 081022_A1       622 20.6   360   wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>  (1.949699 41.9882) 081023_A1       687 14.4   324.  wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>  (1.96177 41.98831) 081024_A1       597 11.8    16.3 wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>  (1.97384 41.98842) 081025_A1       577 14.6   348.  wildland        <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 90 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: forest &lt;list&gt;</span></span></span></code></pre>
<p>Despite the geometries themselves (which have a coordinate reference
system), the following columns are required:</p>
<ul>
<li>
<code>id</code> identifiers of stands (e.g. forest inventory plot
codes)</li>
<li>
<code>elevation</code> (in m), <code>slope</code> (in degrees),
<code>aspect</code> (in degrees) describe the topography of the
stands</li>
<li>
<code>land_cover_type</code> describes the land cover in each unit
(values should be <em>wildland</em> or <em>agriculture</em> for
spatially-uncoupled simulations).</li>
<li>
<code>forest</code> objects of class <strong>forest</strong> (see
package <strong>medfate</strong>) describing the structure and
composition of forest stands</li>
<li>
<code>soil</code> describes the soil of each forest stand, using
either data frame of physical attributes or initialized objects of class
<strong>soil</strong> (see package <strong>medfate</strong>).</li>
</ul>
<p>Note that columns <code>forest</code> and <code>soil</code> contain
vectors of lists, where elements are either lists or data.frames. For
example, the forest corresponding to the first stand is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_ifn</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##   IFNcode           Species DBH Height        N      Z50  Z95</span></span>
<span><span class="co">## 1    0243 Quercus pubescens 1.5    100 318.3099 647.0011 4510</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##   IFNcode           Species Height Cover      Z50  Z95</span></span>
<span><span class="co">## 1    0105 Quercus coccifera     40     1 647.0011 4510</span></span>
<span><span class="co">## 2    0114 Salvia rosmarinus     70     3 203.0918 1000</span></span>
<span><span class="co">## 3    3121        Rubus spp.    110     5 151.6395  684</span></span>
<span><span class="co">## 4    7104    Dorycnium spp.     40     5 153.5119  695</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>and the soil is:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_ifn</span><span class="op">$</span><span class="va">soil</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths     clay  sand   om       bd      rfc</span></span>
<span><span class="co">## 1    300 25.76667 37.90 2.73 1.406667 23.84454</span></span>
<span><span class="co">## 2    700 27.30000 36.35 0.98 1.535000 31.63389</span></span>
<span><span class="co">## 3   1000 27.70000 36.00 0.64 1.560000 53.90746</span></span>
<span><span class="co">## 4   2000 27.70000 36.00 0.64 1.560000 97.50000</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="displaying-maps-of-landscape-properties">Displaying maps of landscape properties<a class="anchor" aria-label="anchor" href="#displaying-maps-of-landscape-properties"></a>
</h3>
<p>Using <code><a href="../reference/extract_variables.html">plot_variable()</a></code> functions for spatial landscape
objects, we can draw maps of some variables using:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_variables.html">plot_variable</a></span><span class="op">(</span><span class="va">example_ifn</span>, <span class="st">"basal_area"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatiallyUncoupledSimulations_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The set of maps available can be known by inspecting the help of
function <code><a href="../reference/extract_variables.html">extract_variables()</a></code>. Alternatively, the package
provides function <code><a href="../reference/shinyplot_land.html">shinyplot_land()</a></code> to display maps
interactively.</p>
</div>
<div class="section level3">
<h3 id="climate-forcing">Climate forcing<a class="anchor" aria-label="anchor" href="#climate-forcing"></a>
</h3>
<p>In <strong>medfateland</strong> there are several alternatives to
specify climate forcing.</p>
<ol style="list-style-type: decimal">
<li>Provide a single data frame with daily weather for all stands.</li>
<li>Provide a different daily weather for each stand (in an additional
column of <code>sf</code> called <code>meteo</code>)</li>
<li>Provide an object to perform daily weather interpolation during
simulations (see later in this document).</li>
</ol>
<p>For most of this document, we will follow the simpler option, which
is to assume the same weather for all stands. We will supply a single
data frame with daily weather for all plots:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"examplemeteo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        dates MinTemperature MaxTemperature Precipitation MinRelativeHumidity</span></span>
<span><span class="co">## 1 2001-01-01     -0.5934215       6.287950      4.869109            65.15411</span></span>
<span><span class="co">## 2 2001-01-02     -2.3662458       4.569737      2.498292            57.43761</span></span>
<span><span class="co">## 3 2001-01-03     -3.8541036       2.661951      0.000000            58.77432</span></span>
<span><span class="co">## 4 2001-01-04     -1.8744860       3.097705      5.796973            66.84256</span></span>
<span><span class="co">## 5 2001-01-05      0.3288287       7.551532      1.884401            62.97656</span></span>
<span><span class="co">## 6 2001-01-06      0.5461322       7.186784     13.359801            74.25754</span></span>
<span><span class="co">##   MaxRelativeHumidity Radiation WindSpeed</span></span>
<span><span class="co">## 1           100.00000  12.89251  2.000000</span></span>
<span><span class="co">## 2            94.71780  13.03079  7.662544</span></span>
<span><span class="co">## 3            94.66823  16.90722  2.000000</span></span>
<span><span class="co">## 4            95.80950  11.07275  2.000000</span></span>
<span><span class="co">## 5           100.00000  13.45205  7.581347</span></span>
<span><span class="co">## 6           100.00000  12.84841  6.570501</span></span></code></pre>
<p>More interesting alternatives are described in the help of function
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>. Notably, a column <code>meteo</code> may be
defined in the <strong>sf</strong> input object, where for each spatial
unit the user can supply a different data frame.</p>
</div>
<div class="section level3">
<h3 id="species-parameters-and-local-control-parameters">Species parameters and local control parameters<a class="anchor" aria-label="anchor" href="#species-parameters-and-local-control-parameters"></a>
</h3>
<p>Since it builds on <strong>medfate</strong>, simulations using
<strong>medfateland</strong> require species parameters and control
parameters for local simulations:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></span>
<span><span class="va">local_control</span> <span class="op">&lt;-</span> <span class="fu">defaultControl</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Importantly, the same control parameters will apply to all spatial
units of the <strong>sf</strong> object.</p>
</div>
</div>
<div class="section level2">
<h2 id="carrying-out-simulations">Carrying out simulations<a class="anchor" aria-label="anchor" href="#carrying-out-simulations"></a>
</h2>
<p>As you should already know, package <strong>medfate</strong> includes
functions <code>spwb()</code>, <code>growth()</code> and
<code>fordyn()</code> to simulate soil water balance, carbon balance and
forest dynamics on a single forest stand, respectively. This section
describe how to run simulations on a set of forest stands in one call.
As an example, we will use function <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>, which
simulates soil plant water balance on forests distributed in particular
locations, but <code><a href="../reference/spwb_spatial.html">growth_spatial()</a></code> and
<code><a href="../reference/spwb_spatial.html">fordyn_spatial()</a></code> are very similar.</p>
<div class="section level3">
<h3 id="calling-the-simulation-function">Calling the simulation function<a class="anchor" aria-label="anchor" href="#calling-the-simulation-function"></a>
</h3>
<p>The call to <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> can be done as follows (here
we use parameter <code>dates</code> restrict the simulation period to
january and february):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-02-28"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">example_ifn</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, </span>
<span>                    dates <span class="op">=</span> <span class="va">dates</span>, local_control <span class="op">=</span> <span class="va">local_control</span>,  </span>
<span>                    parallelize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Simulation of model 'spwb'</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking sf input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking sf input <span style="color: #B2B2B2;">[10ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking meteo object input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking meteo object input <span style="color: #B2B2B2;">[14ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Creating 100 input objects for model 'spwb'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Creating 100 input objects for model 'spwb' <span style="color: #B2B2B2;">[1.8s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Preparing data for parallelization</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Preparing data for parallelization <span style="color: #B2B2B2;">[13ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Launching parallel computation (cores = 7; chunk size = 14)</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Launching parallel computation (cores = 7; chunk size = 14) <span style="color: #B2B2B2;">[13.8s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Retrieval of results</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Retrieval of results <span style="color: #B2B2B2;">[23ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No simulation errors detected</span></span></code></pre>
<p>Function <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> first initializes model inputs
by calling <code>forest2spwbInput()</code> for each forest stand
described in the <strong>sf</strong> landscape object. Then it calls
function <code>spwb()</code> for each forest stand and stores the
result. In this case, we asked for parallel computation via the
parameter <code>parallelize = TRUE</code>.</p>
<p>The simulation result is also an object of class <strong>sf</strong>
with the following columns:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "geometry" "id"       "state"    "result"</span></span></code></pre>
<p>Column <code>geometry</code> contains the geometry given as input to
simulations, column <code>id</code> contains the identification label of
each stand, column <code>state</code> contains the
<code>spwbInput</code> corresponding to each forest stand (which can be
used in subsequent simulations) and column <code>result</code> contains
the output of <code>spwb()</code> function for each forest stand
(i.e. its elements are objects of the S3 class <code>spwb</code>).</p>
</div>
<div class="section level3">
<h3 id="temporal-summaries-plots-and-maps">Temporal summaries, plots and maps<a class="anchor" aria-label="anchor" href="#temporal-summaries-plots-and-maps"></a>
</h3>
<p>The structure of the output of <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> allows
querying information for the simulation of any particular forest stand.
For example, we may use function <code>plot.spwb()</code>, from package
<strong>medfate</strong>, to display the simulation results on a
particular plot:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"Evapotranspiration"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatiallyUncoupledSimulations_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>Similarly, if we want a monthly summary of water balance for the
first stand, we can use function <code>summary.spwb()</code> from
package <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">sum</span>, output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 PET Precipitation      Rain      Snow   NetRain  Snowmelt</span></span>
<span><span class="co">## 2001-01-01 31.14173      74.74949 58.098839 16.650650 40.916807 13.093006</span></span>
<span><span class="co">## 2001-02-01 64.19423       4.99943  2.457859  2.541571  0.949663  5.552842</span></span>
<span><span class="co">##            Infiltration InfiltrationExcess SaturationExcess Runoff DeepDrainage</span></span>
<span><span class="co">## 2001-01-01    54.009813                  0                0      0   0.03083747</span></span>
<span><span class="co">## 2001-02-01     6.502505                  0                0      0   0.07464114</span></span>
<span><span class="co">##            CapillarityRise Evapotranspiration Interception SoilEvaporation</span></span>
<span><span class="co">## 2001-01-01     0.006202281           24.93681    17.182031        0.980304</span></span>
<span><span class="co">## 2001-02-01     0.006839998           16.83964     1.508196        1.379351</span></span>
<span><span class="co">##            HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01                 0        6.774477      6.774477</span></span>
<span><span class="co">## 2001-02-01                 0       13.952094     13.952094</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01               0.3758913</span></span>
<span><span class="co">## 2001-02-01               0.3002900</span></span></code></pre>
<p>However, a more convenient way of generating summaries is by
calculating them on all forest stands in one step, using function
<code><a href="../reference/simulation_summary.html">simulation_summary()</a></code> on objects issued from
simulations:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulation_summary.html">simulation_summary</a></span><span class="op">(</span><span class="va">res</span>, summary_function <span class="op">=</span> <span class="va">summary.spwb</span>, </span>
<span>                              freq<span class="op">=</span><span class="st">"months"</span>, output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></span></code></pre></div>
<p>where the argument <code>summary_function</code> points to the
function to be used to generate local summaries and the remaining
arguments are those of the local summary function. The result of using
<code><a href="../reference/simulation_summary.html">simulation_summary()</a></code> is again an object of class
<code>sf</code> that contains the spatial geometry and the list of
summaries for all stands:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_sum</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "geometry" "id"       "summary"</span></span></code></pre>
<p>The summary for the first stand can now be accessed through the first
element of column <code>summary</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_sum</span><span class="op">$</span><span class="va">summary</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                 PET Precipitation      Rain      Snow   NetRain  Snowmelt</span></span>
<span><span class="co">## 2001-01-01 31.14173      74.74949 58.098839 16.650650 40.916807 13.093006</span></span>
<span><span class="co">## 2001-02-01 64.19423       4.99943  2.457859  2.541571  0.949663  5.552842</span></span>
<span><span class="co">##            Infiltration InfiltrationExcess SaturationExcess Runoff DeepDrainage</span></span>
<span><span class="co">## 2001-01-01    54.009813                  0                0      0   0.03083747</span></span>
<span><span class="co">## 2001-02-01     6.502505                  0                0      0   0.07464114</span></span>
<span><span class="co">##            CapillarityRise Evapotranspiration Interception SoilEvaporation</span></span>
<span><span class="co">## 2001-01-01     0.006202281           24.93681    17.182031        0.980304</span></span>
<span><span class="co">## 2001-02-01     0.006839998           16.83964     1.508196        1.379351</span></span>
<span><span class="co">##            HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01                 0        6.774477      6.774477</span></span>
<span><span class="co">## 2001-02-01                 0       13.952094     13.952094</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01               0.3758913</span></span>
<span><span class="co">## 2001-02-01               0.3002900</span></span></code></pre>
<p>Summary objects are handy because their <code><a href="../reference/plot_summary.html">plot_summary()</a></code>
function allows us to display maps of summaries for specific dates:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_sum</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-01-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatiallyUncoupledSimulations_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_sum</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-02-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatiallyUncoupledSimulations_files/figure-html/unnamed-chunk-14-2.png" width="672" style="display: block; margin: auto;"></p>
<p>To avoid displaying maps one by one, the package includes function
<code><a href="../reference/shinyplot_land.html">shinyplot_land()</a></code> that allows displaying maps of temporal
summaries interactively.</p>
</div>
<div class="section level3">
<h3 id="simulation-with-integrated-temporal-summaries">Simulation with integrated temporal summaries<a class="anchor" aria-label="anchor" href="#simulation-with-integrated-temporal-summaries"></a>
</h3>
<p>If one needs to save memory, it is possible with
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> to generate temporal summaries automatically
after the simulation of soil water balance of each stand, and storing
those summaries instead of all the output of function
<code>spwb()</code>.</p>
<p>For example the following code will keep temporal summaries of water
balance components instead of simulation results:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">example_ifn</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, </span>
<span>                  dates <span class="op">=</span> <span class="va">dates</span>, local_control <span class="op">=</span> <span class="va">local_control</span>,                  </span>
<span>                  keep_results <span class="op">=</span> <span class="cn">FALSE</span>, parallelize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  summary_function <span class="op">=</span> <span class="va">summary.spwb</span>, summary_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>freq<span class="op">=</span><span class="st">"months"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Simulation of model 'spwb'</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking sf input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking sf input <span style="color: #B2B2B2;">[7ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking meteo object input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking meteo object input <span style="color: #B2B2B2;">[11ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Creating 100 input objects for model 'spwb'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Creating 100 input objects for model 'spwb' <span style="color: #B2B2B2;">[1.9s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Preparing data for parallelization</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Preparing data for parallelization <span style="color: #B2B2B2;">[13ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Launching parallel computation (cores = 7; chunk size = 14)</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Launching parallel computation (cores = 7; chunk size = 14) <span style="color: #B2B2B2;">[25.5s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Retrieval of results</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Retrieval of results <span style="color: #B2B2B2;">[42ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No simulation errors detected</span></span></code></pre>
<p>Parameter <code>keep_results = FALSE</code> tells
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> not to keep the simulation results of forest
stands, whereas <code>summary_function = summary.spwb</code> tells
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> to perform and store summaries before
discarding the results of any stand. The output has slightly different
column names:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "geometry" "id"       "state"    "result"   "summary"</span></span></code></pre>
<p>In particular, <code>result</code> is not included. Now the temporal
summaries can be directly accessed through the column
<code>summary</code>:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_2</span><span class="op">$</span><span class="va">summary</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                 PET Precipitation      Rain      Snow   NetRain  Snowmelt</span></span>
<span><span class="co">## 2001-01-01 31.14173      74.74949 58.098839 16.650650 40.916807 13.093006</span></span>
<span><span class="co">## 2001-02-01 64.19423       4.99943  2.457859  2.541571  0.949663  5.552842</span></span>
<span><span class="co">##            Infiltration InfiltrationExcess SaturationExcess Runoff DeepDrainage</span></span>
<span><span class="co">## 2001-01-01    54.009813                  0                0      0   0.03083747</span></span>
<span><span class="co">## 2001-02-01     6.502505                  0                0      0   0.07464114</span></span>
<span><span class="co">##            CapillarityRise Evapotranspiration Interception SoilEvaporation</span></span>
<span><span class="co">## 2001-01-01     0.006202281           24.93681    17.182031        0.980304</span></span>
<span><span class="co">## 2001-02-01     0.006839998           16.83964     1.508196        1.379351</span></span>
<span><span class="co">##            HerbTranspiration PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01                 0        6.774477      6.774477</span></span>
<span><span class="co">## 2001-02-01                 0       13.952094     13.952094</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01               0.3758913</span></span>
<span><span class="co">## 2001-02-01               0.3002900</span></span></code></pre>
<p>And one can produce maps with summary results directly from the
output of the simulation function:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_2</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-02-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatiallyUncoupledSimulations_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The possibility of running a summary function after the simulation of
each stand is not limited to <code>summary.spwb()</code>. Users can
define their own summary functions, provided the first argument is
<code>object</code>, which will contain the result of the simulation
(i.e., the result of calling <code>spwb()</code>, <code>growth()</code>
or <code>fordyn()</code>). For example, the following function returns
the data frame corresponding to plant drought stress:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_stress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">Plants</span><span class="op">$</span><span class="va">PlantStress</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can call again <code>spwb_spatial</code>:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">example_ifn</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>,</span>
<span>                  dates <span class="op">=</span> <span class="va">dates</span>, local_control <span class="op">=</span> <span class="va">local_control</span>,</span>
<span>                  keep_results <span class="op">=</span> <span class="cn">FALSE</span>, parallelize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  summary_function <span class="op">=</span> <span class="va">f_stress</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Simulation of model 'spwb'</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking sf input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking sf input <span style="color: #B2B2B2;">[17ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking meteo object input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking meteo object input <span style="color: #B2B2B2;">[27ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Creating 100 input objects for model 'spwb'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Creating 100 input objects for model 'spwb' <span style="color: #B2B2B2;">[5.4s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Preparing data for parallelization</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Preparing data for parallelization <span style="color: #B2B2B2;">[35ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Launching parallel computation (cores = 7; chunk size = 14)</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Launching parallel computation (cores = 7; chunk size = 14) <span style="color: #B2B2B2;">[31.2s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Retrieval of results</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Retrieval of results <span style="color: #B2B2B2;">[43ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No simulation errors detected</span></span></code></pre>
<p>The drought stress summary of stand 3 is:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_3</span><span class="op">$</span><span class="va">summary</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            T1_171      S1_165 S2_188 S3_183 S4_79</span></span>
<span><span class="co">## 2001-01-01      0 0.003088161      0      0     0</span></span>
<span><span class="co">## 2001-01-02      0 0.002842937      0      0     0</span></span>
<span><span class="co">## 2001-01-03      0 0.002719819      0      0     0</span></span>
<span><span class="co">## 2001-01-04      0 0.002719481      0      0     0</span></span>
<span><span class="co">## 2001-01-05      0 0.002464528      0      0     0</span></span>
<span><span class="co">## 2001-01-06      0 0.002387248      0      0     0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="continuing-a-previous-simulation">Continuing a previous simulation<a class="anchor" aria-label="anchor" href="#continuing-a-previous-simulation"></a>
</h3>
<p>The result of a simulation includes an element <code>state</code>,
which stores the state of soil and stand variables at the end of the
simulation. This information can be used to perform a new simulation
from the point where the first one ended. In order to do so, we need to
update the state variables in spatial object with their values at the
end of the simulation, using function
<code><a href="../reference/update_landscape.html">update_landscape()</a></code>:</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_ifn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_landscape.html">update_landscape</a></span><span class="op">(</span><span class="va">example_ifn</span>, <span class="va">res</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">example_ifn_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "geom"            "id"              "elevation"       "slope"          </span></span>
<span><span class="co">## [5] "aspect"          "land_cover_type" "soil"            "forest"         </span></span>
<span><span class="co">## [9] "state"</span></span></code></pre>
<p>Note that a new column <code>state</code> appears in now in the
<strong>sf</strong> object. We can check the effect by drawing the water
potential in the first soil layer:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_variables.html">plot_variable</a></span><span class="op">(</span><span class="va">example_ifn_mod</span>, <span class="st">"psi1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatiallyUncoupledSimulations_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
<p>By using this new object as input we can now simulate water balance
in the set of stands for an extra month:</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-03-31"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">res_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">example_ifn_mod</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, </span>
<span>                      dates <span class="op">=</span> <span class="va">dates</span>, local_control <span class="op">=</span> <span class="va">local_control</span>, </span>
<span>                      summary_function <span class="op">=</span> <span class="va">summary.spwb</span>, summary_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>freq <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span>,</span>
<span>                      parallelize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Simulation of model 'spwb'</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking sf input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking sf input <span style="color: #B2B2B2;">[17ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking meteo object input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> All input objects are already available for 'spwb'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking meteo object input<span style="color: #00BB00;">✔</span> Checking meteo object input <span style="color: #B2B2B2;">[32ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Preparing data for parallelization</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Preparing data for parallelization <span style="color: #B2B2B2;">[49ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Launching parallel computation (cores = 7; chunk size = 14)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Launching parallel computation (cores = 7; chunk size = 14) <span style="color: #B2B2B2;">[26.8s]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Retrieval of results</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Retrieval of results <span style="color: #B2B2B2;">[48ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> No simulation errors detected</span></span></code></pre>
<p>And display a map with the resulting month transpiration:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_3</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-03-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpatiallyUncoupledSimulations_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="simulations-using-weather-interpolation">Simulations using weather interpolation<a class="anchor" aria-label="anchor" href="#simulations-using-weather-interpolation"></a>
</h3>
<p>Specifying a single weather data frame for all the forest stands may
be not suitable if they are very far from each other. Specifying a
different weather data frame for each stand can also be a problem if
there are thousands of stands to simulate, due to the huge data
requirements. A solution for this can be using interpolation on the fly,
inside simulations. This can be done by supplying an
<strong>interpolator</strong> object (or a list of them), as defined in
package <strong>meteoland</strong>. Here we use the example data
provided in the package:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interpolator</span> <span class="op">&lt;-</span> <span class="fu">meteoland</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/meteoland/man/with_meteo.html" class="external-link">with_meteo</a></span><span class="op">(</span><span class="va">meteoland_meteo_example</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">meteoland</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/meteoland/man/create_meteo_interpolator.html" class="external-link">create_meteo_interpolator</a></span><span class="op">(</span>params <span class="op">=</span> <span class="fu">defaultInterpolationParams</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Creating interpolator...</span></span></code></pre>
<pre><code><span><span class="co">## • Calculating smoothed variables...</span></span></code></pre>
<pre><code><span><span class="co">## • Updating intial_Rp parameter with the actual stations mean distance...</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Interpolator created.</span></span></code></pre>
<p>Once we have this object, using it is straightforward, via parameter
<code>meteo</code>:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">example_ifn_mod</span>, <span class="va">SpParamsMED</span>, meteo <span class="op">=</span> <span class="va">interpolator</span>, </span>
<span>                      local_control <span class="op">=</span> <span class="va">local_control</span>, </span>
<span>                      summary_function <span class="op">=</span> <span class="va">summary.spwb</span>, summary_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>freq <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span>,</span>
<span>                      parallelize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Simulation of model 'spwb'</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking sf input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking sf input <span style="color: #B2B2B2;">[17ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking meteo object input</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> All input objects are already available for 'spwb'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking meteo object input<span style="color: #00BB00;">✔</span> Checking meteo object input <span style="color: #B2B2B2;">[30ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Preparing data for parallelization</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Preparing data for parallelization <span style="color: #B2B2B2;">[96ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Launching parallel computation (cores = 7; chunk size = 14)</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Launching parallel computation (cores = 7; chunk size = 14) <span style="color: #B2B2B2;">[26.5s]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Retrieval of results</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Retrieval of results <span style="color: #B2B2B2;">[59ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> No simulation errors detected</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Aitor Améztegui, María González, Núria Aquilué, Daniel Caviedes-Voullième, Mario Morales-Hernández.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
