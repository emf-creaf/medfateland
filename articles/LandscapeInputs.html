<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landscape inputs • medfateland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Landscape inputs">
<meta property="og:description" content="medfateland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Landscape inputs</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres / Núria Aquilué</h4>
            
            <h4 data-toc-skip class="date">2024-05-07</h4>
      
      
      <div class="hidden name"><code>LandscapeInputs.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="aim">Aim<a class="anchor" aria-label="anchor" href="#aim"></a>
</h2>
<p>This vignette has been created to illustrate the creation of spatial
inputs to be used in model simulations with the package, starting from a
set of coordinates.</p>
<p>Before reading this vignette, users should be familiar with
<em>forest</em> and <em>soil</em> structures in package
<strong>medfate</strong>. Moreover, a brief introduction to spatial
structures used in <strong>medfateland</strong> package is given in
vignette <a href="https://emf-creaf.github.io/medfateland/articles/PackageOverview.html" class="external-link">Package
overview</a> and examples are given in vignettes <a href="https://emf-creaf.github.io/medfateland/articles/SpatiallyUncoupledSimulations.html" class="external-link">Spatially-uncoupled
simulations</a> and <a href="https://emf-creaf.github.io/medfateland/articles/WatershedSimulations.html" class="external-link">Watershed
simulations</a>.</p>
</div>
<div class="section level2">
<h2 id="target-coordinates">Target coordinates<a class="anchor" aria-label="anchor" href="#target-coordinates"></a>
</h2>
<p>Any spatial dataset should begin with the definition of spatial
elements. Here we will use a set of coordinates taken from the package,
as example. In particular we have 66 target points defined by
coordinates in EPSG:32631 (UTM for fuse 31) projection.</p>
<p>The coordinates are in form of a matrix with dimensions:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 66  2</span></span></code></pre>
<p>and here is the beginning of the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           X       Y</span></span>
<span><span class="co">## [1,] 402630 4672570</span></span>
<span><span class="co">## [2,] 402330 4672470</span></span>
<span><span class="co">## [3,] 402430 4672470</span></span>
<span><span class="co">## [4,] 402530 4672470</span></span>
<span><span class="co">## [5,] 402630 4672470</span></span>
<span><span class="co">## [6,] 402730 4672470</span></span></code></pre>
<p>The first step is to use package <code>sf</code> to define a spatial
object of whose simple features are our target points:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span>, </span>
<span>                  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, </span>
<span>                  crs <span class="op">=</span> <span class="st">"EPSG:32631"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="topography-and-land-cover-type">Topography and land cover type<a class="anchor" aria-label="anchor" href="#topography-and-land-cover-type"></a>
</h2>
<p>Once an object <code>sf</code> has been defined with target
locations, we need to determine topographic features (elevation, slope,
aspect) and land cover corresponding to those locations. You should have
access to a Digital Elevation Model (DEM) at a desired resolution. Here
we will use a DEM raster for Catalonia at 30 m resolution, which we load
using package <code>terra</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_path</span> <span class="op">&lt;-</span> <span class="st">"~/OneDrive/EMF_datasets/"</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"Topography/Products/Catalunya/MET30m_ETRS89_UTM31_ICGC.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dem</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 9282, 9391, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 30, 30  (x, y)</span></span>
<span><span class="co">## extent      : 258097.5, 539827.5, 4485488, 4763948  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : ETRS89 / UTM zone 31N (EPSG:25831) </span></span>
<span><span class="co">## source      : MET30m_ETRS89_UTM31_ICGC.tif </span></span>
<span><span class="co">## name        : met15v20as0f0118Bmr1r050 </span></span>
<span><span class="co">## min value   :                   -7.120 </span></span>
<span><span class="co">## max value   :                 3133.625</span></span></code></pre>
<p>Similarly, you should have downloaded a land cover map, in this case
we will use a land cover raster for Catalonia, issued in 2018:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lcm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"LandCover/Sources/Catalunya/cobertes-sol-v1r0-2018.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lcm</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 259198, 267234, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">## extent      : 260170, 527404, 4488784, 4747982  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : ETRS89 / UTM zone 31N (EPSG:25831) </span></span>
<span><span class="co">## source      : cobertes-sol-v1r0-2018.tif </span></span>
<span><span class="co">## color table : 1 </span></span>
<span><span class="co">## name        : cobertes-sol-v1r0-2018</span></span></code></pre>
<p>You should examine the legend of their land cover map and decide how
to map legend elements to the five land cover types used in
<strong>medfateland</strong>. After inspecting our land cover map
legend, we define the following vectors to perform the legend
mapping:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agriculture</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span></span>
<span><span class="va">wildland</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">17</span>,<span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">rock</span> <span class="op">&lt;-</span> <span class="fl">18</span><span class="op">:</span><span class="fl">19</span></span>
<span><span class="va">artificial</span> <span class="op">&lt;-</span> <span class="fl">21</span><span class="op">:</span><span class="fl">35</span></span>
<span><span class="va">water</span> <span class="op">&lt;-</span> <span class="fl">36</span><span class="op">:</span><span class="fl">41</span></span></code></pre></div>
<p>Having these inputs, we can use function
<code><a href="../reference/create_landscape.html">create_landscape()</a></code> to add topographic and land cover
features to our starting <code>sf</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_landscape.html">create_landscape</a></span><span class="op">(</span><span class="va">x</span>, dem <span class="op">=</span> <span class="va">dem</span>, land_cover_map <span class="op">=</span> <span class="va">lcm</span>, </span>
<span>                      wildland <span class="op">=</span> <span class="va">wildland</span>, </span>
<span>                      agriculture <span class="op">=</span> <span class="va">agriculture</span>, </span>
<span>                      rock <span class="op">=</span> <span class="va">rock</span>, </span>
<span>                      artificial <span class="op">=</span> <span class="va">artificial</span>, </span>
<span>                      water <span class="op">=</span> <span class="va">water</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking inputs</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking inputs <span style="color: #B2B2B2;">[13ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'id'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'id' <span style="color: #B2B2B2;">[10ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography <span style="color: #B2B2B2;">[7.6s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting land cover</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting land cover <span style="color: #B2B2B2;">[28ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>We can examine the result using:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 66 features and 5 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 401430 ymin: 4671870 xmax: 402830 ymax: 4672570</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 66 × 6</span></span></span>
<span><span class="co">##            geometry    id elevation slope aspect land_cover_type</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (402630 4672570)     1     <span style="text-decoration: underline;">1</span>163.  9.09   38.2 wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (402330 4672470)     2     <span style="text-decoration: underline;">1</span>217.  2.93  109.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (402430 4672470)     3     <span style="text-decoration: underline;">1</span>199. 19.3   131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (402530 4672470)     4     <span style="text-decoration: underline;">1</span>169. 21.2   123.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (402630 4672470)     5     <span style="text-decoration: underline;">1</span>146. 12.2   110.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (402730 4672470)     6     <span style="text-decoration: underline;">1</span>126.  9.69  131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (402830 4672470)     7     <span style="text-decoration: underline;">1</span>115.  6.01   88.2 agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> (402230 4672370)     8     <span style="text-decoration: underline;">1</span>225. 17.1   102.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> (402330 4672370)     9     <span style="text-decoration: underline;">1</span>199. 14.2   133.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> (402430 4672370)    10     <span style="text-decoration: underline;">1</span>178. 11.5    98.9 agriculture    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 56 more rows</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="forest-imputation">Forest imputation<a class="anchor" aria-label="anchor" href="#forest-imputation"></a>
</h2>
<p>The next step is to define <code>forest</code> objects for our
simulations. Forests should be defined for all target locations whose
land cover is defined as <code>wildland</code>. Arguably, there are
multiple ways to address the goal of defining forest objects. Here we
will assume what we believe will be the most common situation. While you
may not have access to forest inventory plots on the target locations,
it is quite usual to have access to (national) forest inventory data and
some kind of forest map where polygons or raster cells describe the
distribution of forest (or shrubland) types. Our task here will be to
perform imputations of forest inventory plots to our target locations
according to some criteria.</p>
<p>We start by loading the Spanish Forest Map (1:25000) for the region
of Catalonia, which is in vector format, using package
<code>terra</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest_map</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"ForestMaps/Products/Catalunya/mfe25_cat_class.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">forest_map</span></span></code></pre></div>
<pre><code><span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : polygons </span></span>
<span><span class="co">##  dimensions  : 238096, 1  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 0.1591812, 3.332506, 40.523, 42.86144  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  source      : mfe25_cat_class.shp</span></span>
<span><span class="co">##  coord. ref. : lon/lat ETRS89 (EPSG:4258) </span></span>
<span><span class="co">##  names       :              Class</span></span>
<span><span class="co">##  type        :              &lt;chr&gt;</span></span>
<span><span class="co">##  values      : Pinus halepensis_3</span></span>
<span><span class="co">##                Pinus halepensis_3</span></span>
<span><span class="co">##                Pinus halepensis_3</span></span></code></pre>
<p>We also load an <code>sf</code> object that contains coordinates and
forest objects corresponding to the Third Spanish Forest Inventory for
Catalonia:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfi_path</span> <span class="op">&lt;-</span> <span class="st">"/home/miquel/OneDrive/mcaceres_work/model_initialisation/medfate_initialisation/IFN/"</span></span>
<span><span class="va">sf_nfi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">nfi_path</span>, <span class="st">"Products/IFN3/Catalunya/IFN3_cat_final_ETRS89H31.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sf_nfi</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 12180 features and 14 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 260919 ymin: 4498773 xmax: 519906.3 ymax: 4746796</span></span>
<span><span class="co">## Projected CRS: ETRS89 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 12,180 × 15</span></span></span>
<span><span class="co">##    Provincia Estadillo Clase Subclase IDPARCELA IDCLASE ID       id    elevation</span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 08        0001      A     1        080001    A1      080001_… 0800…      <span style="text-decoration: underline;">1</span>826</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 08        0002      A     1        080002    A1      080002_… 0800…      <span style="text-decoration: underline;">1</span>840</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 08        0003      A     1        080003    A1      080003_… 0800…      <span style="text-decoration: underline;">1</span>672</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 08        0004      A     1        080004    A1      080004_… 0800…      <span style="text-decoration: underline;">1</span>394</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 08        0005      A     1        080005    A1      080005_… 0800…      <span style="text-decoration: underline;">1</span>371</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 08        0006      A     1        080006    A1      080006_… 0800…      <span style="text-decoration: underline;">1</span>674</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 08        0007      A     1        080007    A1      080007_… 0800…      <span style="text-decoration: underline;">1</span>426</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 08        0008      A     1        080008    A1      080008_… 0800…      <span style="text-decoration: underline;">1</span>062</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 08        0009      A     1        080009    A1      080009_… 0800…      <span style="text-decoration: underline;">1</span>024</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 08        0010      A     1        080010    A1      080010_… 0800…      <span style="text-decoration: underline;">1</span>436</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 12,170 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6 more variables: slope &lt;dbl&gt;, aspect &lt;dbl&gt;, soil &lt;list&gt;, forest &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   forest_allrecords &lt;named list&gt;, geom &lt;POINT [m]&gt;</span></span></span></code></pre>
<p>Note that this is already an <code>sf</code> object suitable for
simulations, but refers to the locations of the forest inventory plots,
not to our target area.</p>
<p>Having these inputs, we can use function
<code><a href="../reference/impute_forests.html">impute_forests()</a></code> to perform the imputation for us (this
normally take some time):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_forests.html">impute_forests</a></span><span class="op">(</span><span class="va">y</span>, sf_nfi <span class="op">=</span> <span class="va">sf_nfi</span>, <span class="va">dem</span>, <span class="va">forest_map</span>, varClass <span class="op">=</span> <span class="st">"Class"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking inputs</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking inputs <span style="color: #B2B2B2;">[5ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating northing-slope</span></span></code></pre>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating northing-slope <span style="color: #B2B2B2;">[23.1s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating mean/sd topography</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating mean/sd topography <span style="color: #B2B2B2;">[9.5s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'x' <span style="color: #B2B2B2;">[28ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'sf_nfi' <span style="color: #B2B2B2;">[580ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'x' <span style="color: #B2B2B2;">[5.6s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'sf_nfi' <span style="color: #B2B2B2;">[5s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'forest'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'forest' <span style="color: #B2B2B2;">[13ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Imputation</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Imputation <span style="color: #B2B2B2;">[226ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>Details are given in the help manual of the function, but shortly,
the function performs the imputation of forest inventory plots on target
locations provided that they correspond to the same forest class,
defined in the forest map. Among the multiple plots that can fulfill
this criterion, the function chooses the plot that has the most similar
elevation and position in the N-to-S slopes (i.e. the product of the
cosine of aspect and slope).</p>
<p>We can see the result with an extra column <code>forest</code>
here:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 66 features and 6 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 401430 ymin: 4671870 xmax: 402830 ymax: 4672570</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 66 × 7</span></span></span>
<span><span class="co">##            geometry    id elevation slope aspect land_cover_type</span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span>      <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (402630 4672570)     1     <span style="text-decoration: underline;">1</span>163.  9.09   38.2 wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (402330 4672470)     2     <span style="text-decoration: underline;">1</span>217.  2.93  109.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (402430 4672470)     3     <span style="text-decoration: underline;">1</span>199. 19.3   131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (402530 4672470)     4     <span style="text-decoration: underline;">1</span>169. 21.2   123.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (402630 4672470)     5     <span style="text-decoration: underline;">1</span>146. 12.2   110.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (402730 4672470)     6     <span style="text-decoration: underline;">1</span>126.  9.69  131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (402830 4672470)     7     <span style="text-decoration: underline;">1</span>115.  6.01   88.2 agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> (402230 4672370)     8     <span style="text-decoration: underline;">1</span>225. 17.1   102.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> (402330 4672370)     9     <span style="text-decoration: underline;">1</span>199. 14.2   133.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> (402430 4672370)    10     <span style="text-decoration: underline;">1</span>178. 11.5    98.9 agriculture    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 56 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: forest &lt;list&gt;</span></span></span></code></pre>
<p>Only <code>wildland</code> locations will have a <code>forest</code>
object, for example:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##              Species  DBH Height          N      Z50  Z95</span></span>
<span><span class="co">## 1   Pinus sylvestris 14.1    550   31.83099 346.9401 2006</span></span>
<span><span class="co">## 2 Juniperus communis  5.0    200  127.32395 199.9600  980</span></span>
<span><span class="co">## 3 Buxus sempervirens  1.5    100 1273.23955 218.5410 1100</span></span>
<span><span class="co">## 4 Juniperus communis  1.5    100 1273.23955 199.9600  980</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##       Species Cover Height      Z50  Z95</span></span>
<span><span class="co">## 1 Retama spp.     5     80 291.5464 1600</span></span>
<span><span class="co">## 2 Thymus spp.    10     20 110.8215  455</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] 40</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] 20</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="soil-parameterization">Soil parameterization<a class="anchor" aria-label="anchor" href="#soil-parameterization"></a>
</h2>
<p>Soil information is most usually lacking for the target locations.
Regional maps of soil properties may be available in some cases. Here we
assume this information is not available, so that we resort to global
products. In particular, we will use information provided in <a href="https://soilgrids.org/" class="external-link">SoilGrids</a> at 250 m resolution.
Function <code><a href="../reference/add_soilgrids.html">add_soilgrids()</a></code> can perform queries using the REST
API of SoilGrids, but this becomes problematic for multiple sites.
Hence, we recommend downloading SoilGrid rasters for the target region
and storing them in a particular format, so that function
<code><a href="../reference/add_soilgrids.html">add_soilgrids()</a></code> can read them (check the details of the
function documentation). The extraction of SoilGrids data for our target
cells is rather fast using this approach:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soilgrids_path</span> <span class="op">=</span> <span class="st">"~/OneDrive/EMF_datasets/Soils/Sources/Global/SoilGrids/Spain/"</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_soilgrids.html">add_soilgrids</a></span><span class="op">(</span><span class="va">y</span>, soilgrids_path <span class="op">=</span> <span class="va">soilgrids_path</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'soil'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'soil' <span style="color: #B2B2B2;">[5ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting 65 wildland/agriculture points from SoilGrids raster layers:</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting 65 wildland/agriculture points from SoilGrids raster layers: <span style="color: #B2B2B2;">[329m</span>…</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>And the result has an extra column <code>soil</code>:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 66 features and 7 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 401430 ymin: 4671870 xmax: 402830 ymax: 4672570</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 66 × 8</span></span></span>
<span><span class="co">##            geometry    id elevation slope aspect land_cover_type</span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span>      <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (402630 4672570)     1     <span style="text-decoration: underline;">1</span>163.  9.09   38.2 wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (402330 4672470)     2     <span style="text-decoration: underline;">1</span>217.  2.93  109.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (402430 4672470)     3     <span style="text-decoration: underline;">1</span>199. 19.3   131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (402530 4672470)     4     <span style="text-decoration: underline;">1</span>169. 21.2   123.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (402630 4672470)     5     <span style="text-decoration: underline;">1</span>146. 12.2   110.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (402730 4672470)     6     <span style="text-decoration: underline;">1</span>126.  9.69  131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (402830 4672470)     7     <span style="text-decoration: underline;">1</span>115.  6.01   88.2 agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> (402230 4672370)     8     <span style="text-decoration: underline;">1</span>225. 17.1   102.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> (402330 4672370)     9     <span style="text-decoration: underline;">1</span>199. 14.2   133.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> (402430 4672370)    10     <span style="text-decoration: underline;">1</span>178. 11.5    98.9 agriculture    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 56 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: forest &lt;list&gt;, soil &lt;list&gt;</span></span></span></code></pre>
<p>The elements of the list are the usual data frames of soil properties
in <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span><span class="op">$</span><span class="va">soil</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths clay sand   om   bd  rfc nitrogen</span></span>
<span><span class="co">## 1     50 25.3 35.3 6.54 1.28 19.3     4.42</span></span>
<span><span class="co">## 2    100 25.2 35.3 3.86 1.34 21.3     2.88</span></span>
<span><span class="co">## 3    150 25.6 34.8 2.53 1.36 19.4     2.09</span></span>
<span><span class="co">## 4    300 28.3 33.8 1.63 1.40 20.5     1.46</span></span>
<span><span class="co">## 5    400 27.8 33.8 1.08 1.47 20.0     0.85</span></span>
<span><span class="co">## 6   1000 27.0 35.3 1.02 1.50 20.8     0.71</span></span></code></pre>
<p>SoilGrids does not provide information on soil depth, and rock
fragment content is normally underestimated, which leads to an
overestimation of water holding capacity. We will come to this issue in
future updates of this vignette.</p>
</div>
<div class="section level2">
<h2 id="initialization-test">Initialization test<a class="anchor" aria-label="anchor" href="#initialization-test"></a>
</h2>
<p>We can check whether the input data set is well formed by calling
function <code><a href="../reference/initialize_landscape.html">initialize_landscape()</a></code>:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize_landscape.html">initialize_landscape</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">SpParamsMED</span>, <span class="fu">defaultControl</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Creating 65 input objects for model 'spwb'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Creating 65 input objects for model 'spwb'. <span style="color: #B2B2B2;">[4ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>Other variables may be needed, depending on the simulation function
we want to use, but here we illustrated the basic ones.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Aitor Améztegui, María González, Núria Aquilué, Daniel Caviedes-Voullième, Mario Morales-Hernández.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
