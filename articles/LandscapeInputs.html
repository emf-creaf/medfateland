<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landscape inputs • medfateland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Landscape inputs">
<meta property="og:description" content="medfateland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Landscape inputs</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres / Núria Aquilué</h4>
            
            <h4 data-toc-skip class="date">2024-05-08</h4>
      
      
      <div class="hidden name"><code>LandscapeInputs.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="aim">Aim<a class="anchor" aria-label="anchor" href="#aim"></a>
</h2>
<p>This vignette has been created to illustrate the creation of spatial
inputs to be used in model simulations with the package, starting from a
set of coordinates.</p>
<p>Before reading this vignette, users should be familiar with
<em>forest</em> and <em>soil</em> structures in package
<strong>medfate</strong>. Moreover, a brief introduction to spatial
structures used in <strong>medfateland</strong> package is given in
vignette <a href="https://emf-creaf.github.io/medfateland/articles/PackageOverview.html" class="external-link">Package
overview</a> and examples are given in vignettes <a href="https://emf-creaf.github.io/medfateland/articles/SpatiallyUncoupledSimulations.html" class="external-link">Spatially-uncoupled
simulations</a> and <a href="https://emf-creaf.github.io/medfateland/articles/WatershedSimulations.html" class="external-link">Watershed
simulations</a>.</p>
</div>
<div class="section level2">
<h2 id="target-coordinates">Target coordinates<a class="anchor" aria-label="anchor" href="#target-coordinates"></a>
</h2>
<p>Any spatial dataset should begin with the definition of spatial
elements. Here we will use a set of coordinates taken from the package,
as example. In particular we have 66 target points defined by
coordinates in EPSG:32631 (UTM for fuse 31) projection.</p>
<p>The coordinates are in form of a matrix with dimensions:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 66  2</span></span></code></pre>
<p>and here is the beginning of the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           X       Y</span></span>
<span><span class="co">## [1,] 402630 4672570</span></span>
<span><span class="co">## [2,] 402330 4672470</span></span>
<span><span class="co">## [3,] 402430 4672470</span></span>
<span><span class="co">## [4,] 402530 4672470</span></span>
<span><span class="co">## [5,] 402630 4672470</span></span>
<span><span class="co">## [6,] 402730 4672470</span></span></code></pre>
<p>The first step is to use package <code>sf</code> to define a spatial
object of whose simple features are our target points:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">cc</span><span class="op">)</span>, </span>
<span>                  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, </span>
<span>                  crs <span class="op">=</span> <span class="st">"EPSG:32631"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="topography-and-land-cover-type">Topography and land cover type<a class="anchor" aria-label="anchor" href="#topography-and-land-cover-type"></a>
</h2>
<p>Once an object <code>sf</code> has been defined with target
locations, we need to determine topographic features (elevation, slope,
aspect) and land cover corresponding to those locations. You should have
access to a Digital Elevation Model (DEM) at a desired resolution. Here
we will use a DEM raster for Catalonia at 30 m resolution, which we load
using package <code>terra</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_path</span> <span class="op">&lt;-</span> <span class="st">"~/OneDrive/EMF_datasets/"</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"Topography/Products/Catalunya/MET30m_ETRS89_UTM31_ICGC.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dem</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 9282, 9391, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 30, 30  (x, y)</span></span>
<span><span class="co">## extent      : 258097.5, 539827.5, 4485488, 4763948  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : ETRS89 / UTM zone 31N (EPSG:25831) </span></span>
<span><span class="co">## source      : MET30m_ETRS89_UTM31_ICGC.tif </span></span>
<span><span class="co">## name        : met15v20as0f0118Bmr1r050 </span></span>
<span><span class="co">## min value   :                   -7.120 </span></span>
<span><span class="co">## max value   :                 3133.625</span></span></code></pre>
<p>Similarly, you should have downloaded a land cover map, in this case
we will use a land cover raster for Catalonia, issued in 2018:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lcm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"LandCover/Sources/Catalunya/cobertes-sol-v1r0-2018.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lcm</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 259198, 267234, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">## extent      : 260170, 527404, 4488784, 4747982  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : ETRS89 / UTM zone 31N (EPSG:25831) </span></span>
<span><span class="co">## source      : cobertes-sol-v1r0-2018.tif </span></span>
<span><span class="co">## color table : 1 </span></span>
<span><span class="co">## name        : cobertes-sol-v1r0-2018</span></span></code></pre>
<p>You should examine the legend of their land cover map and decide how
to map legend elements to the five land cover types used in
<strong>medfateland</strong>. After inspecting our land cover map
legend, we define the following vectors to perform the legend
mapping:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agriculture</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span></span>
<span><span class="va">wildland</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">17</span>,<span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">rock</span> <span class="op">&lt;-</span> <span class="fl">18</span><span class="op">:</span><span class="fl">19</span></span>
<span><span class="va">artificial</span> <span class="op">&lt;-</span> <span class="fl">21</span><span class="op">:</span><span class="fl">35</span></span>
<span><span class="va">water</span> <span class="op">&lt;-</span> <span class="fl">36</span><span class="op">:</span><span class="fl">41</span></span></code></pre></div>
<p>Having these inputs, we can use function
<code><a href="../reference/create_landscape.html">create_landscape()</a></code> to add topographic and land cover
features to our starting <code>sf</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_landscape.html">create_landscape</a></span><span class="op">(</span><span class="va">x</span>, dem <span class="op">=</span> <span class="va">dem</span>, land_cover_map <span class="op">=</span> <span class="va">lcm</span>, </span>
<span>                        wildland <span class="op">=</span> <span class="va">wildland</span>, </span>
<span>                        agriculture <span class="op">=</span> <span class="va">agriculture</span>, </span>
<span>                        rock <span class="op">=</span> <span class="va">rock</span>, </span>
<span>                        artificial <span class="op">=</span> <span class="va">artificial</span>, </span>
<span>                        water <span class="op">=</span> <span class="va">water</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking inputs</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking inputs <span style="color: #B2B2B2;">[22ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'id'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'id' <span style="color: #B2B2B2;">[13ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography</span></span></code></pre>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography <span style="color: #B2B2B2;">[13s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting land cover</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting land cover <span style="color: #B2B2B2;">[45ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>We can examine the result using:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_1</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 66 features and 5 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 401430 ymin: 4671870 xmax: 402830 ymax: 4672570</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 66 × 6</span></span></span>
<span><span class="co">##            geometry    id elevation slope aspect land_cover_type</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (402630 4672570)     1     <span style="text-decoration: underline;">1</span>163.  9.09   38.2 wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (402330 4672470)     2     <span style="text-decoration: underline;">1</span>217.  2.93  109.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (402430 4672470)     3     <span style="text-decoration: underline;">1</span>199. 19.3   131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (402530 4672470)     4     <span style="text-decoration: underline;">1</span>169. 21.2   123.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (402630 4672470)     5     <span style="text-decoration: underline;">1</span>146. 12.2   110.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (402730 4672470)     6     <span style="text-decoration: underline;">1</span>126.  9.69  131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (402830 4672470)     7     <span style="text-decoration: underline;">1</span>115.  6.01   88.2 agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> (402230 4672370)     8     <span style="text-decoration: underline;">1</span>225. 17.1   102.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> (402330 4672370)     9     <span style="text-decoration: underline;">1</span>199. 14.2   133.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> (402430 4672370)    10     <span style="text-decoration: underline;">1</span>178. 11.5    98.9 agriculture    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 56 more rows</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="forest-parameterization">Forest parameterization<a class="anchor" aria-label="anchor" href="#forest-parameterization"></a>
</h2>
<p>The next step is to define <code>forest</code> objects for our
simulations. Forests should be defined for all target locations whose
land cover is defined as <code>wildland</code>. When forest inventory
plots are not be available for the target locations, one must resort on
imputations.</p>
<ol style="list-style-type: decimal">
<li>Forest inventory data from nearby locations. National forest
inventories are ideal in this respect.</li>
<li>A forest map where polygons or raster cells describe the
distribution of forest (or shrubland) types.</li>
<li>Raster source of vegetation structure (i.e. mean tree height or
basal area), derived from aerial or satellite LiDAR missions.</li>
</ol>
<p>Our task here will be to perform imputations of forest inventory
plots to our target locations according to some criteria and, if
possible, to correct the forest structure on those locations according
to available data.</p>
<div class="section level3">
<h3 id="forest-imputation">Forest imputation<a class="anchor" aria-label="anchor" href="#forest-imputation"></a>
</h3>
<p>A map of forest types in the target area is important to determine
dominant tree or shrub species. We start by loading the Spanish Forest
Map (1:25000) for the region of Catalonia, which is in vector format,
using package <code>terra</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forest_map</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"ForestMaps/Products/Catalunya/mfe25_cat_class.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">forest_map</span></span></code></pre></div>
<pre><code><span><span class="co">##  class       : SpatVector </span></span>
<span><span class="co">##  geometry    : polygons </span></span>
<span><span class="co">##  dimensions  : 238096, 1  (geometries, attributes)</span></span>
<span><span class="co">##  extent      : 0.1591812, 3.332506, 40.523, 42.86144  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">##  source      : mfe25_cat_class.shp</span></span>
<span><span class="co">##  coord. ref. : lon/lat ETRS89 (EPSG:4258) </span></span>
<span><span class="co">##  names       :              Class</span></span>
<span><span class="co">##  type        :              &lt;chr&gt;</span></span>
<span><span class="co">##  values      : Pinus halepensis_3</span></span>
<span><span class="co">##                Pinus halepensis_3</span></span>
<span><span class="co">##                Pinus halepensis_3</span></span></code></pre>
<p>Second, we need forest inventory data for imputations. Arguably, this
is the hardest part. Let’s assume one has access to a such data already
in format for package <em>medfateland</em> (how to build such data set
will be illustrated in a different vignette). We also load an
<code>sf_nfi</code> object that contains coordinates and forest objects
corresponding to the Third Spanish Forest Inventory for Catalonia:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfi_path</span> <span class="op">&lt;-</span> <span class="st">"/home/miquel/OneDrive/mcaceres_work/model_initialisation/medfate_initialisation/IFN/"</span></span>
<span><span class="va">sf_nfi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">nfi_path</span>, <span class="st">"Products/IFN3/Catalunya/IFN3_cat_final_ETRS89H31.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sf_nfi</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 12180 features and 14 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 260919 ymin: 4498773 xmax: 519906.3 ymax: 4746796</span></span>
<span><span class="co">## Projected CRS: ETRS89 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 12,180 × 15</span></span></span>
<span><span class="co">##    Provincia Estadillo Clase Subclase IDPARCELA IDCLASE ID       id    elevation</span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 08        0001      A     1        080001    A1      080001_… 0800…      <span style="text-decoration: underline;">1</span>826</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 08        0002      A     1        080002    A1      080002_… 0800…      <span style="text-decoration: underline;">1</span>840</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 08        0003      A     1        080003    A1      080003_… 0800…      <span style="text-decoration: underline;">1</span>672</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 08        0004      A     1        080004    A1      080004_… 0800…      <span style="text-decoration: underline;">1</span>394</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 08        0005      A     1        080005    A1      080005_… 0800…      <span style="text-decoration: underline;">1</span>371</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 08        0006      A     1        080006    A1      080006_… 0800…      <span style="text-decoration: underline;">1</span>674</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 08        0007      A     1        080007    A1      080007_… 0800…      <span style="text-decoration: underline;">1</span>426</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 08        0008      A     1        080008    A1      080008_… 0800…      <span style="text-decoration: underline;">1</span>062</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 08        0009      A     1        080009    A1      080009_… 0800…      <span style="text-decoration: underline;">1</span>024</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 08        0010      A     1        080010    A1      080010_… 0800…      <span style="text-decoration: underline;">1</span>436</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 12,170 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6 more variables: slope &lt;dbl&gt;, aspect &lt;dbl&gt;, soil &lt;list&gt;, forest &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   forest_allrecords &lt;named list&gt;, geom &lt;POINT [m]&gt;</span></span></span></code></pre>
<p>Note that this is already an <code>sf</code> object suitable for
simulations, but refers to the locations of the forest inventory plots,
not to our target area.</p>
<p>Having these two inputs (forest map and forest inventory data), we
can use function <code><a href="../reference/impute_forests.html">impute_forests()</a></code> to perform the imputation
for us (this normally take some time):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_forests.html">impute_forests</a></span><span class="op">(</span><span class="va">y_1</span>, sf_nfi <span class="op">=</span> <span class="va">sf_nfi</span>, dem <span class="op">=</span> <span class="va">dem</span>, </span>
<span>                      forest_map <span class="op">=</span> <span class="va">forest_map</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking inputs</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking inputs <span style="color: #B2B2B2;">[6ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating northing-slope</span></span></code></pre>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating northing-slope <span style="color: #B2B2B2;">[34.4s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating topography mean and sd values</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating topography mean and sd values <span style="color: #B2B2B2;">[12s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'x' <span style="color: #B2B2B2;">[39ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'sf_nfi' <span style="color: #B2B2B2;">[745ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'x' <span style="color: #B2B2B2;">[5.8s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'sf_nfi' <span style="color: #B2B2B2;">[5s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Equidistant conic coordinates</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Equidistant conic coordinates <span style="color: #B2B2B2;">[89ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'forest'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'forest' <span style="color: #B2B2B2;">[11ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Imputation</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Imputation <span style="color: #B2B2B2;">[10ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>For each target location, the function selects forest inventory plots
that correspond to the same forest class, defined in the forest map, and
are geographically closer than a pre-specified maximum distance. Among
the multiple plots that can fulfill this criterion, the function chooses
the plot that has the most similar elevation and position in the N-to-S
slopes (i.e. the product of the cosine of aspect and slope). More
details can be found in the documentation of
<code><a href="../reference/impute_forests.html">impute_forests()</a></code>.</p>
<p>The resulting <code>sf</code> has an extra column named
<code>forest</code>:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_2</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 66 features and 6 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 401430 ymin: 4671870 xmax: 402830 ymax: 4672570</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 66 × 7</span></span></span>
<span><span class="co">##            geometry    id elevation slope aspect land_cover_type</span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span>      <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (402630 4672570)     1     <span style="text-decoration: underline;">1</span>163.  9.09   38.2 wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (402330 4672470)     2     <span style="text-decoration: underline;">1</span>217.  2.93  109.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (402430 4672470)     3     <span style="text-decoration: underline;">1</span>199. 19.3   131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (402530 4672470)     4     <span style="text-decoration: underline;">1</span>169. 21.2   123.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (402630 4672470)     5     <span style="text-decoration: underline;">1</span>146. 12.2   110.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (402730 4672470)     6     <span style="text-decoration: underline;">1</span>126.  9.69  131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (402830 4672470)     7     <span style="text-decoration: underline;">1</span>115.  6.01   88.2 agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> (402230 4672370)     8     <span style="text-decoration: underline;">1</span>225. 17.1   102.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> (402330 4672370)     9     <span style="text-decoration: underline;">1</span>199. 14.2   133.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> (402430 4672370)    10     <span style="text-decoration: underline;">1</span>178. 11.5    98.9 agriculture    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 56 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: forest &lt;list&gt;</span></span></span></code></pre>
<p>Only <code>wildland</code> locations will have a <code>forest</code>
object, for example:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_2</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##               Species      DBH    Height          N      Z50  Z95</span></span>
<span><span class="co">## 1    Pinus sylvestris 38.20000 1250.0000   14.14711 346.9401 2006</span></span>
<span><span class="co">## 2    Pinus sylvestris 35.10000 1000.0000   14.14711 346.9401 2006</span></span>
<span><span class="co">## 3    Pinus sylvestris 28.88046  996.8506   56.58842 346.9401 2006</span></span>
<span><span class="co">## 4    Pinus sylvestris 25.68895  945.0069   99.02974 346.9401 2006</span></span>
<span><span class="co">## 5    Pinus sylvestris 20.98394  955.9217  190.98593 346.9401 2006</span></span>
<span><span class="co">## 6    Pinus sylvestris 15.35000  900.0000   31.83099 346.9401 2006</span></span>
<span><span class="co">## 7    Pinus sylvestris 10.05560  528.7931  381.97186 346.9401 2006</span></span>
<span><span class="co">## 8  Juniperus communis  5.00000  250.0000  127.32395 199.9600  980</span></span>
<span><span class="co">## 9    Pinus sylvestris  5.00000  350.0000  636.61977 346.9401 2006</span></span>
<span><span class="co">## 10 Amelanchier ovalis  1.50000  100.0000 1273.23955 392.2431 2353</span></span>
<span><span class="co">## 11 Buxus sempervirens  1.50000  100.0000 2546.47909 218.5410 1100</span></span>
<span><span class="co">## 12 Juniperus communis  1.50000  100.0000  318.30989 199.9600  980</span></span>
<span><span class="co">## 13   Pinus sylvestris  1.50000  100.0000 2546.47909 346.9401 2006</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##     Species Cover Height      Z50 Z95</span></span>
<span><span class="co">## 1 Ulex spp.     2     30 201.8408 992</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] 30</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="forest-imputation-with-structure-correction">Forest imputation with structure correction<a class="anchor" aria-label="anchor" href="#forest-imputation-with-structure-correction"></a>
</h3>
<p>The former imputation result would be already useful for simulations,
but the forest structure in the target locations can be very different
than that of the forest inventory used as reference, even if the forest
types are the same. Therefore, it is advisable to correct the forest
structure with available information.</p>
<p>There are several global products made recently available, that
combine satellite LiDAR observations with other information, such as <a href="https://doi.org/10.1029/2011JG001708" class="external-link">Simard et al. (2011)</a>, <a href="https://doi.org/10.1016/j.rse.2020.112165" class="external-link">Potapov et
al. (2021)</a> or <a href="https://doi.org/10.1038/s41559-023-02206-6" class="external-link">Lang et
al. (2023)</a>. Alternatively, airborne LiDAR products are available for
some countries and regions. Here we will use structural information
derived from LiDAR flights in Catalonia. First we will load a mean tree
height raster at 20-m resolution:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">height_map</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>, <span class="st">"RemoteSensing/Sources/Catalunya/Lidar/VariablesBiofisiques/RastersComplets/2016-2017/variables-biofisiques-arbrat-v1r0-hmitjana-2016-2017.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">height_map</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 13100, 13400, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 20, 20  (x, y)</span></span>
<span><span class="co">## extent      : 260000, 528000, 4488000, 4750000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : ETRS89 / UTM zone 31N (EPSG:25831) </span></span>
<span><span class="co">## source      : variables-biofisiques-arbrat-v1r0-hmitjana-2016-2017.tif </span></span>
<span><span class="co">## name        : variables-biofisiques-arbrat-v1r0-hmitjana-2016-2017</span></span></code></pre>
<p>This resolution is finer than the size of forest inventory plots, and
the errors in the plot coordinates may lead to missing height data (the
map only deals with areas with forest cover). Hence, we aggregate the
raster to 100-m resolution:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">height_map_100</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">height_map</span>, fact <span class="op">=</span> <span class="fl">5</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<p>We call again <code><a href="../reference/impute_forests.html">impute_forests()</a></code> to perform the imputation
while correcting tree height:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_forests.html">impute_forests</a></span><span class="op">(</span><span class="va">y_1</span>, sf_nfi <span class="op">=</span> <span class="va">sf_nfi</span>, dem <span class="op">=</span> <span class="va">dem</span>, </span>
<span>                      forest_map <span class="op">=</span> <span class="va">forest_map</span>, height_map <span class="op">=</span> <span class="va">height_map_100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking inputs</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking inputs <span style="color: #B2B2B2;">[5ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating northing-slope</span></span></code></pre>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating northing-slope <span style="color: #B2B2B2;">[26.9s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating topography mean and sd values</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating topography mean and sd values <span style="color: #B2B2B2;">[10s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'x' <span style="color: #B2B2B2;">[29ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'sf_nfi' <span style="color: #B2B2B2;">[553ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'x' <span style="color: #B2B2B2;">[5.5s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'sf_nfi' <span style="color: #B2B2B2;">[4.9s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting height for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting height for 'x' <span style="color: #B2B2B2;">[23ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting height for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting height for 'sf_nfi' <span style="color: #B2B2B2;">[147ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Equidistant conic coordinates</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Equidistant conic coordinates <span style="color: #B2B2B2;">[85ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'forest'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'forest' <span style="color: #B2B2B2;">[12ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Imputation</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Imputation <span style="color: #B2B2B2;">[10ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>The function does not force average tree height of the stand in the
target location to match the height map. Rather, it uses the ratio of
heights between the target location and the forest inventory plot used
as imputation source, to correct the tree heights of the target
location. Tree diameters are corrected with the same factor, assuming
that the diameter-height relationship does not depend on tree height.
This leads consequently in a change in basal area (see below). We can
inspect the same forest as above to see the effect of the
correction:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_3</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##               Species       DBH    Height          N      Z50  Z95</span></span>
<span><span class="co">## 1    Pinus sylvestris 28.109134 919.80150   14.14711 346.9401 2006</span></span>
<span><span class="co">## 2    Pinus sylvestris 25.828026 735.84120   14.14711 346.9401 2006</span></span>
<span><span class="co">## 3    Pinus sylvestris 20.077842 714.74258  141.47106 346.9401 2006</span></span>
<span><span class="co">## 4    Pinus sylvestris 15.525785 700.15062  205.13304 346.9401 2006</span></span>
<span><span class="co">## 5    Pinus sylvestris  8.329292 459.79399  286.47890 346.9401 2006</span></span>
<span><span class="co">## 6  Juniperus communis  3.679206 183.96030  127.32395 199.9600  980</span></span>
<span><span class="co">## 7    Pinus sylvestris  4.237321 284.89807  763.94373 346.9401 2006</span></span>
<span><span class="co">## 8  Amelanchier ovalis  1.103762  73.58412 1273.23955 392.2431 2353</span></span>
<span><span class="co">## 9  Buxus sempervirens  1.103762  73.58412 2546.47909 218.5410 1100</span></span>
<span><span class="co">## 10 Juniperus communis  1.103762  73.58412  318.30989 199.9600  980</span></span>
<span><span class="co">## 11   Pinus sylvestris  1.103762  73.58412 2546.47909 346.9401 2006</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##     Species Cover Height      Z50 Z95</span></span>
<span><span class="co">## 1 Ulex spp.     2     30 201.8408 992</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] 30</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>Additionally, one may have access to other maps of structural
variables. In our case, we will use a raster of basal area, also derived
from LiDAR flights:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basal_area_map</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>, <span class="st">"RemoteSensing/Sources/Catalunya/Lidar/VariablesBiofisiques/RastersComplets/2016-2017/variables-biofisiques-arbrat-v1r0-ab-2016-2017.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">basal_area_map</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 13100, 13400, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 20, 20  (x, y)</span></span>
<span><span class="co">## extent      : 260000, 528000, 4488000, 4750000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : ETRS89 / UTM zone 31N (EPSG:25831) </span></span>
<span><span class="co">## source      : variables-biofisiques-arbrat-v1r0-ab-2016-2017.tif </span></span>
<span><span class="co">## name        : variables-biofisiques-arbrat-v1r0-ab-2016-2017</span></span></code></pre>
<p>We perform the same aggregation done for heights:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basal_area_map_100</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">basal_area_map</span>, fact <span class="op">=</span> <span class="fl">5</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<p>Finally, we call again function <code><a href="../reference/impute_forests.html">impute_forests()</a></code> with
both height and basal area maps:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute_forests.html">impute_forests</a></span><span class="op">(</span><span class="va">y_1</span>, sf_nfi <span class="op">=</span> <span class="va">sf_nfi</span>, dem <span class="op">=</span> <span class="va">dem</span>, </span>
<span>                      forest_map <span class="op">=</span> <span class="va">forest_map</span>, height_map <span class="op">=</span> <span class="va">height_map_100</span>, basal_area_map <span class="op">=</span> <span class="va">basal_area_map_100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Checking inputs</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Checking inputs <span style="color: #B2B2B2;">[5ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating northing-slope</span></span></code></pre>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating northing-slope <span style="color: #B2B2B2;">[28.2s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Calculating topography mean and sd values</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Calculating topography mean and sd values <span style="color: #B2B2B2;">[9.7s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'x' <span style="color: #B2B2B2;">[26ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting topography for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting topography for 'sf_nfi' <span style="color: #B2B2B2;">[545ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'x' <span style="color: #B2B2B2;">[5.2s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting forest class for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting forest class for 'sf_nfi' <span style="color: #B2B2B2;">[5.5s]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting height for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting height for 'x' <span style="color: #B2B2B2;">[20ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting height for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting height for 'sf_nfi' <span style="color: #B2B2B2;">[135ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting basal area for 'x'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting basal area for 'x' <span style="color: #B2B2B2;">[21ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting basal area for 'sf_nfi'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting basal area for 'sf_nfi' <span style="color: #B2B2B2;">[153ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Equidistant conic coordinates</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Equidistant conic coordinates <span style="color: #B2B2B2;">[60ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'forest'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'forest' <span style="color: #B2B2B2;">[10ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Imputation</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Imputation <span style="color: #B2B2B2;">[10ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>Correction for basal area operates on tree density. Analogously to
the correction of heights, it does not take the basal area value of the
map for the target location, but the ratio of values between the target
location and the forest inventory plot used as reference for imputation.
This ratio is used to correct tree density. We can inspect the same
forest again to see the changes in <code>N</code> (density per hectare)
column:</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_4</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $treeData</span></span>
<span><span class="co">##               Species       DBH    Height          N      Z50  Z95</span></span>
<span><span class="co">## 1    Pinus sylvestris 28.109134 919.80150   18.72282 346.9401 2006</span></span>
<span><span class="co">## 2    Pinus sylvestris 25.828026 735.84120   18.72282 346.9401 2006</span></span>
<span><span class="co">## 3    Pinus sylvestris 20.077842 714.74258  187.22824 346.9401 2006</span></span>
<span><span class="co">## 4    Pinus sylvestris 15.525785 700.15062  271.48095 346.9401 2006</span></span>
<span><span class="co">## 5    Pinus sylvestris  8.329292 459.79399  379.13719 346.9401 2006</span></span>
<span><span class="co">## 6  Juniperus communis  3.679206 183.96030  168.50542 199.9600  980</span></span>
<span><span class="co">## 7    Pinus sylvestris  4.237321 284.89807 1011.03251 346.9401 2006</span></span>
<span><span class="co">## 8  Amelanchier ovalis  1.103762  73.58412 1685.05419 392.2431 2353</span></span>
<span><span class="co">## 9  Buxus sempervirens  1.103762  73.58412 3370.10838 218.5410 1100</span></span>
<span><span class="co">## 10 Juniperus communis  1.103762  73.58412  421.26355 199.9600  980</span></span>
<span><span class="co">## 11   Pinus sylvestris  1.103762  73.58412 3370.10838 346.9401 2006</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $shrubData</span></span>
<span><span class="co">##     Species Cover Height      Z50 Z95</span></span>
<span><span class="co">## 1 Ulex spp.     2     30 201.8408 992</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbCover</span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $herbHeight</span></span>
<span><span class="co">## [1] 30</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "forest" "list"</span></span></code></pre>
<p>We can compare the effect of the two corrections (height only or
height + basal area) on forest metrics, such as the dominant tree
height:</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">medfate</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_dominantTreeHeight</a></span><span class="op">(</span><span class="va">y_2</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 981.6587</span></span></code></pre>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">medfate</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_dominantTreeHeight</a></span><span class="op">(</span><span class="va">y_3</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 733.589</span></span></code></pre>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">medfate</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_dominantTreeHeight</a></span><span class="op">(</span><span class="va">y_4</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 733.589</span></span></code></pre>
<p>or stand basal area:</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">medfate</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_basalArea</a></span><span class="op">(</span><span class="va">y_2</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 22.05743</span></span></code></pre>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">medfate</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_basalArea</a></span><span class="op">(</span><span class="va">y_3</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 11.5428</span></span></code></pre>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">medfate</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_basalArea</a></span><span class="op">(</span><span class="va">y_4</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">22</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 15.27619</span></span></code></pre>
<p>where it is apparent that both the height correction and the basal
area correction have an effect in basal area.</p>
</div>
</div>
<div class="section level2">
<h2 id="soil-parameterization">Soil parameterization<a class="anchor" aria-label="anchor" href="#soil-parameterization"></a>
</h2>
<p>Soil information is most usually lacking for the target locations.
Regional maps of soil properties may be available in some cases. Here we
assume this information is not available, so that we resort to global
products. In particular, we will use information provided in <a href="https://soilgrids.org/" class="external-link">SoilGrids</a> at 250 m resolution.
Function <code><a href="../reference/add_soilgrids.html">add_soilgrids()</a></code> can perform queries using the REST
API of SoilGrids, but this becomes problematic for multiple sites.
Hence, we recommend downloading SoilGrid rasters for the target region
and storing them in a particular format, so that function
<code><a href="../reference/add_soilgrids.html">add_soilgrids()</a></code> can read them (check the details of the
function documentation). The extraction of SoilGrids data for our target
cells is rather fast using this approach:</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soilgrids_path</span> <span class="op">=</span> <span class="st">"~/OneDrive/EMF_datasets/Soils/Sources/Global/SoilGrids/Spain/"</span></span>
<span><span class="va">y_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_soilgrids.html">add_soilgrids</a></span><span class="op">(</span><span class="va">y_4</span>, soilgrids_path <span class="op">=</span> <span class="va">soilgrids_path</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Defining column 'soil'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Defining column 'soil' <span style="color: #B2B2B2;">[5ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Extracting 65 points from SoilGrids raster layers:</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Extracting 65 points from SoilGrids raster layers: <span style="color: #B2B2B2;">[365ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>And the result has an extra column <code>soil</code>:</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_5</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 66 features and 7 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 401430 ymin: 4671870 xmax: 402830 ymax: 4672570</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 66 × 8</span></span></span>
<span><span class="co">##            geometry    id elevation slope aspect land_cover_type</span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span>      <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (402630 4672570)     1     <span style="text-decoration: underline;">1</span>163.  9.09   38.2 wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (402330 4672470)     2     <span style="text-decoration: underline;">1</span>217.  2.93  109.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (402430 4672470)     3     <span style="text-decoration: underline;">1</span>199. 19.3   131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (402530 4672470)     4     <span style="text-decoration: underline;">1</span>169. 21.2   123.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (402630 4672470)     5     <span style="text-decoration: underline;">1</span>146. 12.2   110.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (402730 4672470)     6     <span style="text-decoration: underline;">1</span>126.  9.69  131.  agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (402830 4672470)     7     <span style="text-decoration: underline;">1</span>115.  6.01   88.2 agriculture    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> (402230 4672370)     8     <span style="text-decoration: underline;">1</span>225. 17.1   102.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> (402330 4672370)     9     <span style="text-decoration: underline;">1</span>199. 14.2   133.  wildland       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> (402430 4672370)    10     <span style="text-decoration: underline;">1</span>178. 11.5    98.9 agriculture    </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 56 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: forest &lt;list&gt;, soil &lt;list&gt;</span></span></span></code></pre>
<p>The elements of the list are the usual data frames of soil properties
in <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_5</span><span class="op">$</span><span class="va">soil</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths clay sand   om   bd  rfc nitrogen</span></span>
<span><span class="co">## 1     50 25.3 35.3 6.54 1.28 19.3     4.42</span></span>
<span><span class="co">## 2    100 25.2 35.3 3.86 1.34 21.3     2.88</span></span>
<span><span class="co">## 3    150 25.6 34.8 2.53 1.36 19.4     2.09</span></span>
<span><span class="co">## 4    300 28.3 33.8 1.63 1.40 20.5     1.46</span></span>
<span><span class="co">## 5    400 27.8 33.8 1.08 1.47 20.0     0.85</span></span>
<span><span class="co">## 6   1000 27.0 35.3 1.02 1.50 20.8     0.71</span></span></code></pre>
<p>SoilGrids does not provide information on soil depth, and rock
fragment content is normally underestimated, which leads to an
overestimation of water holding capacity. We will come to this issue in
future updates of this vignette.</p>
</div>
<div class="section level2">
<h2 id="initialization-test">Initialization test<a class="anchor" aria-label="anchor" href="#initialization-test"></a>
</h2>
<p>We can check whether the input data set is well formed by calling
function <code><a href="../reference/initialize_landscape.html">initialize_landscape()</a></code>:</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize_landscape.html">initialize_landscape</a></span><span class="op">(</span><span class="va">y_5</span>, <span class="va">SpParamsMED</span>, <span class="fu">defaultControl</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Creating 65 input objects for model 'spwb'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Creating 65 input objects for model 'spwb'. <span style="color: #B2B2B2;">[5ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>Other variables may be needed, depending on the simulation function
we want to use, but here we illustrated the basic ones.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Aitor Améztegui, María González, Núria Aquilué, Daniel Caviedes-Voullième, Mario Morales-Hernández.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
