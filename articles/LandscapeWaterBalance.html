<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landscape water balance • medfateland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Landscape water balance">
<meta property="og:description" content="medfateland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Landscape water balance</h1>
                        <h4 data-toc-skip class="author">Miquel De
Caceres</h4>
            
            <h4 data-toc-skip class="date">2022-11-23</h4>
      
      
      <div class="hidden name"><code>LandscapeWaterBalance.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="displaying-properties-of-spatial-objects">Displaying properties of spatial objects<a class="anchor" aria-label="anchor" href="#displaying-properties-of-spatial-objects"></a>
</h2>
<p>We begin by loading an example dataset of 100 forest stands
distributed on points in the landscape:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"examplepointslandscape"</span><span class="op">)</span></span></code></pre></div>
<p>We transform the data set to class <em>sf</em> because <em>sp</em>
objects are deprecated from ver. 1.0.0 on.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="../reference/sp_to_sf.html">sp_to_sf</a></span><span class="op">(</span><span class="va">examplepointslandscape</span><span class="op">)</span></span>
<span><span class="va">y</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 100 features and 11 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 402000 ymin: 4640000 xmax: 429000 ymax: 4646000</span></span>
<span><span class="co">## Projected CRS: ETRS89 / UTM zone 31N</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 100 × 12</span></span></span>
<span><span class="co">##            geometry id    elevation slope aspect land_cover_type forest   soil  </span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> (411000 4646000) 81065       516  9.94   92.7 wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> (412000 4646000) 81066       537 13.7   115.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> (413000 4646000) 81067       578 23.3   152.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> (415000 4646000) 81068       615 12.7   360.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> (416000 4646000) 81069       644 22.5   186.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> (423000 4646000) 81070       520  4.04  225.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> (426000 4646000) 81073       608 12.2   337.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> (428000 4646000) 81075       745  8.06  332.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> (402000 4645000) 81076       527 14.4   245.  wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> (404000 4645000) 81077       483 26.0    36.7 wildland        &lt;forest&gt; &lt;soil&gt;</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 90 more rows, and 4 more variables: state &lt;list&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   represented_area &lt;lgl&gt;, management_unit &lt;lgl&gt;, management_arguments &lt;list&gt;</span></span></span></code></pre>
<p>Using <code><a href="../reference/extract_variables.html">plot_variable()</a></code> functions for spatial landscape
objects, we can draw maps of some variables using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_variables.html">plot_variable</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"basal_area"</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The set of maps available can be known by inspecting the help of
function <code><a href="../reference/extract_variables.html">extract_variables()</a></code>. Alternatively, the package
provides function <code><a href="../reference/shinyplot_land.html">shinyplot_land()</a></code> to display maps
interactively.</p>
</div>
<div class="section level2">
<h2 id="simulations-on-a-set-of-forest-stands">Simulations on a set of forest stands<a class="anchor" aria-label="anchor" href="#simulations-on-a-set-of-forest-stands"></a>
</h2>
<p>Package <code>medfate</code> includes functions <code>spwb()</code>,
<code>growth()</code> and <code>fordyn()</code> to simulate soil water
balance, carbon balance and forest dynamics on a single forest stand,
respectively. This section describe how to run simulations on a set of
forest stands in one call. This is done using functions
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>, <code><a href="../reference/spwb_spatial.html">growth_spatial()</a></code> and
<code><a href="../reference/spwb_spatial.html">fordyn_spatial()</a></code>, respectively.</p>
<p>As an example, we will use function <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>,
which simulates soil plant water balance on forests distributed in
particular locations. The function takes an object of class
<code>sf</code> as input.</p>
<div class="section level3">
<h3 id="weather-inputs-and-local-control-parameters">Weather inputs and local control parameters<a class="anchor" aria-label="anchor" href="#weather-inputs-and-local-control-parameters"></a>
</h3>
<p>As before, we need meteorological data, species parameters and
control parameters for local simulations (which will apply to all forest
stands):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"examplemeteo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></span>
<span><span class="va">local_control</span> <span class="op">=</span> <span class="fu">defaultControl</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calling-the-simulation-function">Calling the simulation function<a class="anchor" aria-label="anchor" href="#calling-the-simulation-function"></a>
</h3>
<p>The call to <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> can be done as follows (here
we restrict the dates for simplicity):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-02-28"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, </span>
<span>                  dates <span class="op">=</span> <span class="va">dates</span>, local_control <span class="op">=</span> <span class="va">local_control</span>,  progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Function <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> first initializes model inputs
by calling <code>forest2spwbInput()</code> for each forest stand
described in the <code>sf</code> landscape object. Then it calls
function <code>spwb()</code> for each forest stand and stores the
result. The fact that we used <code>examplemeteo</code> as
meteorological input involves that the same weather was applied to all
forest stands, but different weather could have been specified for each
one (see documentation of function <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>).</p>
<p>The result of calling <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> is an object of
class <code>sf</code> with the following columns:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "geometry" "id"       "state"    "result"   "summary"</span></span></code></pre>
<p>Element <code>geometry</code> contains the geometry given as input to
simulations, vector <code>state</code> contains the
<code>spwbInput</code> corresponding to each forest stand (which can be
used in subsequent simulations), vector <code>result</code> contains the
output of <code>spwb()</code> function for each forest stand (i.e. its
elements are objects of the S3 class <code>spwb</code>) and
<code>summary</code> contains summaries (if requested, see below).</p>
</div>
<div class="section level3">
<h3 id="temporal-summaries-plots-and-maps">Temporal summaries, plots and maps<a class="anchor" aria-label="anchor" href="#temporal-summaries-plots-and-maps"></a>
</h3>
<p>The structure of the output of <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> allows
querying information for the simulation of any particular forest stand.
For example, we may use function <code>plot.spwb()</code>, from package
<strong>medfate</strong>, to display the simulation results on a
particular plot:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"Evapotranspiration"</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>Similarly, if we want a monthly summary of water balance for the
first stand, we can use function <code>summary.spwb()</code> from
package <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">sum</span>, output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 PET Precipitation      Rain      Snow    NetRain  Snowmelt</span></span>
<span><span class="co">## 2001-01-01 45.07945      74.74949 58.098839 16.650650 38.7641740 13.093006</span></span>
<span><span class="co">## 2001-02-01 84.71521       4.99943  2.457859  2.541571  0.9249101  5.552842</span></span>
<span><span class="co">##            Infiltration Runoff DeepDrainage Evapotranspiration Interception</span></span>
<span><span class="co">## 2001-01-01    51.857180      0  39.53244935           35.36906    19.334665</span></span>
<span><span class="co">## 2001-02-01     6.477752      0   0.03075641           22.23615     1.532949</span></span>
<span><span class="co">##            SoilEvaporation PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01        5.482694        10.54935      10.55170</span></span>
<span><span class="co">## 2001-02-01        0.874228        19.81821      19.82898</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01              0.03208459</span></span>
<span><span class="co">## 2001-02-01              0.00000000</span></span></code></pre>
<p>However, a more convenient way of generating summaries is by
calculating them on all forest stands in one step, using function
<code><a href="../reference/simulation_summary.html">simulation_summary()</a></code> on objects issued from
simulations:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulation_summary.html">simulation_summary</a></span><span class="op">(</span><span class="va">res</span>, summaryFunction <span class="op">=</span> <span class="va">summary.spwb</span>, </span>
<span>                              freq<span class="op">=</span><span class="st">"months"</span>, output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></span></code></pre></div>
<p>where the argument <code>summaryFunction</code> points to the
function to be used to generate local summaries and the remaining
arguments are those of the local summary function. The result of using
<code><a href="../reference/simulation_summary.html">simulation_summary()</a></code> is again an object of class
<code>sf</code> that contains the spatial geometry and the list of
summaries for all stands:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res_sum</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "geometry" "summary"</span></span></code></pre>
<p>The summary for the first stand can now be accessed through the first
element of <code>summary</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_sum</span><span class="op">$</span><span class="va">summary</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                 PET Precipitation      Rain      Snow    NetRain  Snowmelt</span></span>
<span><span class="co">## 2001-01-01 45.07945      74.74949 58.098839 16.650650 38.7641740 13.093006</span></span>
<span><span class="co">## 2001-02-01 84.71521       4.99943  2.457859  2.541571  0.9249101  5.552842</span></span>
<span><span class="co">##            Infiltration Runoff DeepDrainage Evapotranspiration Interception</span></span>
<span><span class="co">## 2001-01-01    51.857180      0  39.53244935           35.36906    19.334665</span></span>
<span><span class="co">## 2001-02-01     6.477752      0   0.03075641           22.23615     1.532949</span></span>
<span><span class="co">##            SoilEvaporation PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01        5.482694        10.54935      10.55170</span></span>
<span><span class="co">## 2001-02-01        0.874228        19.81821      19.82898</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01              0.03208459</span></span>
<span><span class="co">## 2001-02-01              0.00000000</span></span></code></pre>
<p>Summary objects are handy because their <code><a href="../reference/plot_summary.html">plot_summary()</a></code>
function allows us to display maps of summaries for specific dates:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_sum</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-01-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_sum</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-02-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-12-2.png" width="672" style="display: block; margin: auto;"></p>
<p>To avoid displaying maps one by one, the package includes function
<code><a href="../reference/shinyplot_land.html">shinyplot_land()</a></code> that allows displaying maps of temporal
summaries interactively.</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-simulation-features">Advanced simulation features<a class="anchor" aria-label="anchor" href="#advanced-simulation-features"></a>
</h2>
<div class="section level3">
<h3 id="simulation-with-integrated-temporal-summaries">Simulation with integrated temporal summaries<a class="anchor" aria-label="anchor" href="#simulation-with-integrated-temporal-summaries"></a>
</h3>
<p>If one needs to save memory, it is possible with
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> to generate temporal summaries automatically
after the simulation of soil water balance of each stand, and storing
those summaries instead of all the output of function
<code>spwb()</code>.</p>
<p>For example the following code will keep temporal summaries of water
balance components instead of simulation results:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, </span>
<span>                  dates <span class="op">=</span> <span class="va">dates</span>, local_control <span class="op">=</span> <span class="va">local_control</span>,                  </span>
<span>                  keep_results <span class="op">=</span> <span class="cn">FALSE</span>, progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  summaryFunction <span class="op">=</span> <span class="va">summary.spwb</span>, summaryArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>freq<span class="op">=</span><span class="st">"months"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Parameter <code>keep_results = FALSE</code> tells
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> not to keep the simulation results of forest
stands, whereas <code>summaryFunction = summary.spwb</code> tells
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> to perform and store summaries before
discarding the results of any stand.</p>
<p>Now the temporal summaries are embedded in the simulation results,
and can be directly accessed through the element
<code>summarylist</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_2</span><span class="op">$</span><span class="va">summary</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                 PET Precipitation      Rain      Snow    NetRain  Snowmelt</span></span>
<span><span class="co">## 2001-01-01 45.07945      74.74949 58.098839 16.650650 38.7641740 13.093006</span></span>
<span><span class="co">## 2001-02-01 84.71521       4.99943  2.457859  2.541571  0.9249101  5.552842</span></span>
<span><span class="co">##            Infiltration Runoff DeepDrainage Evapotranspiration Interception</span></span>
<span><span class="co">## 2001-01-01    51.857180      0  39.53244935           35.36906    19.334665</span></span>
<span><span class="co">## 2001-02-01     6.477752      0   0.03075641           22.23615     1.532949</span></span>
<span><span class="co">##            SoilEvaporation PlantExtraction Transpiration</span></span>
<span><span class="co">## 2001-01-01        5.482694        10.54935      10.55170</span></span>
<span><span class="co">## 2001-02-01        0.874228        19.81821      19.82898</span></span>
<span><span class="co">##            HydraulicRedistribution</span></span>
<span><span class="co">## 2001-01-01              0.03208459</span></span>
<span><span class="co">## 2001-02-01              0.00000000</span></span></code></pre>
<p>And one can produce maps with summary results directly from the
output of the simulation function:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_2</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-02-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="simulation-in-several-steps">Simulation in several steps<a class="anchor" aria-label="anchor" href="#simulation-in-several-steps"></a>
</h3>
<p>The result of a simulation includes an element <code>state</code>,
which stores the state of soil and stand variables at the end of the
simulation. This information can be used to perform a new simulation
from the point where the first one ended. In order to do so, we need to
update the state variables in spatial object with their values at the
end of the simulation, using function
<code><a href="../reference/update_landscape.html">update_landscape()</a></code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">=</span> <span class="fu"><a href="../reference/update_landscape.html">update_landscape</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object <code>w</code> is the same as <code>y</code>
except for the state variables. For example we can compare the water
potential in the first soil layer:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_variables.html">plot_variable</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"psi1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_variables.html">plot_variable</a></span><span class="op">(</span><span class="va">w</span>, <span class="st">"psi1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-17-2.png" width="672" style="display: block; margin: auto;"></p>
<p>By using <code>w</code> as input we can now simulate water balance in
the set of stands for an extra month:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-03-31"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">res_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spwb_spatial.html">spwb_spatial</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, </span>
<span>                      dates <span class="op">=</span> <span class="va">dates</span>, local_control <span class="op">=</span> <span class="va">local_control</span>, </span>
<span>                      summaryFunction <span class="op">=</span> <span class="va">summary.spwb</span>, summaryArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>freq<span class="op">=</span><span class="st">"months"</span><span class="op">)</span>,</span>
<span>                      progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>And display a map with the resulting month transpiration:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_3</span>, <span class="st">"Transpiration"</span>, <span class="st">"2001-03-01"</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="simulation-of-watershed-hydrology">Simulation of watershed hydrology<a class="anchor" aria-label="anchor" href="#simulation-of-watershed-hydrology"></a>
</h2>
<p>Simulation of watershed hydrology involves describing a watershed in
a gridded mode and simulating soil water balance water while including
additional compartments and hydrological processes, such as routing
runoff from one cell to the other.</p>
<div class="section level3">
<h3 id="example-data-set">Example data set<a class="anchor" aria-label="anchor" href="#example-data-set"></a>
</h3>
<p>To illustrate this kind of simulation, which is carried out using
function <code><a href="../reference/spwb_land.html">spwb_land()</a></code>, we first load a small example
watershed included with the package, which we transform to
<code>sf</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"examplewatershed"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="../reference/sp_to_sf.html">sp_to_sf</a></span><span class="op">(</span><span class="va">examplewatershed</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/extract_variables.html">plot_variable</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"elevation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="simulation-function">Simulation function<a class="anchor" aria-label="anchor" href="#simulation-function"></a>
</h3>
<p>As for the call to function <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> we will use
the same weather (i.e. <code>examplemeteo</code>) across the watershed.
To speed up calculations we call function <code><a href="../reference/spwb_land.html">spwb_land()</a></code> for a
single month.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2001-01-31"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">res_ws</span> <span class="op">=</span> <span class="fu"><a href="../reference/spwb_land.html">spwb_land</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">SpParamsMED</span>, <span class="va">examplemeteo</span>, dates <span class="op">=</span> <span class="va">dates</span>, summary_frequency <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## ------------ spwb_land ------------</span></span>
<span><span class="co">## Grid cells: 66, patchsize: 100 m2, area: 0.66 ha</span></span>
<span><span class="co">## Cell land use wildland: 48 agriculture: 17 artificial: 0 rock: 1 water: 0</span></span>
<span><span class="co">## Cells with soil: 65</span></span>
<span><span class="co">## Meteorological input class: data.frame</span></span>
<span><span class="co">## Number of days to simulate: 31</span></span>
<span><span class="co">## Number of summaries: 1</span></span>
<span><span class="co">## Number of outlet cells: 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Preparing spwb input...</span></span>
<span><span class="co">## done.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initial average soil water content (mm): 530.8</span></span>
<span><span class="co">## Initial average snowpack water content (mm): 0</span></span>
<span><span class="co">## Initial average aquifer water content (mm): 0</span></span>
<span><span class="co">## Initial watershed water content (mm): 522.76</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Performing daily simulations:</span></span>
<span><span class="co">## .+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++.+++++done</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Final average soil water content (mm): 530.8</span></span>
<span><span class="co">## Final average snowpack water content (mm): 0.05</span></span>
<span><span class="co">## Final average aquifer water content (mm): 57.08</span></span>
<span><span class="co">## Final watershed water content (mm): 522.76</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Change in snowpack water content (mm): 0.05</span></span>
<span><span class="co">## Snowpack water balance result (mm): 2.96</span></span>
<span><span class="co">## Snowpack water balance components:</span></span>
<span><span class="co">##   Snow fall (mm) 16.65 Snow melt (mm) 13.69</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Change in soil water content (mm): 0</span></span>
<span><span class="co">## Soil water balance result (mm): -1.27</span></span>
<span><span class="co">## Soil water balance components:</span></span>
<span><span class="co">##   Net rainfall (mm) 52.39 Snow melt (mm) 13.7</span></span>
<span><span class="co">##   Runon (mm) 1.1 Runoff (mm) 0</span></span>
<span><span class="co">##   Subsurface input (mm) 0  Subsurface output (mm) 0</span></span>
<span><span class="co">##   Deep drainage (mm) 57.96 Aquifer discharge (mm) 0</span></span>
<span><span class="co">##   Soil evaporation (mm) 6.89 Plant transpiration (mm) 3.61</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Change in aquifer water content (mm): 57.08</span></span>
<span><span class="co">## Aquifer water balance result (mm): 57.08</span></span>
<span><span class="co">## Aquifer water balance components:</span></span>
<span><span class="co">##   Deep drainage (mm) 57.08 Aquifer discharge (mm) 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Change in watershed water content (mm): 0</span></span>
<span><span class="co">## Watershed water balance result (mm): 58.78</span></span>
<span><span class="co">## Watershed water balance components:</span></span>
<span><span class="co">##   Precipitation (mm) 74.75</span></span>
<span><span class="co">##   Interception (mm) 5.62 Soil evaporation (mm) 6.79 Plant Transpiration (mm) 3.56</span></span>
<span><span class="co">##   Export (mm) 0</span></span>
<span><span class="co">## Watershed lateral flows:</span></span>
<span><span class="co">##   Subsurface flow (mm) 0</span></span>
<span><span class="co">##   Groundwater flow (mm) 9.03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ------------ spwb_land ------------</span></span></code></pre>
<p>Although simulations are performed using daily temporal steps,
parameter <code>summary_frequency</code> allows storing results at
coarser temporal scales, to reduce the amount of memory in spatial
results.</p>
</div>
<div class="section level3">
<h3 id="summaries-and-plots">Summaries and plots<a class="anchor" aria-label="anchor" href="#summaries-and-plots"></a>
</h3>
<p>Unlike <code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code> where summaries could be
arbitrarily generated <em>a posteriori</em> from simulation results,
with <code><a href="../reference/spwb_land.html">spwb_land()</a></code> the summaries are always fixed and
embedded with the simulation result. For example, we can inspect the
summaries for a given landscape cell using:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_ws</span><span class="op">$</span><span class="va">sf</span><span class="op">$</span><span class="va">summary</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##            Runon Runoff Infiltration     Rain  NetRain     Snow Snowmelt</span></span>
<span><span class="co">## 2001-01-01     0      0     66.96921 58.09884 53.31927 16.65065 13.64994</span></span>
<span><span class="co">##            Interception DeepDrainage AquiferDischarge SaturationExcess</span></span>
<span><span class="co">## 2001-01-01     4.779566     57.63314                0                0</span></span>
<span><span class="co">##            SoilEvaporation Transpiration SWE  SoilVol        Psi1  WTD      DTA</span></span>
<span><span class="co">## 2001-01-01        7.007932      3.224297   0 563.8283 -0.03300001 4000 14.72179</span></span>
<span><span class="co">##            InterflowInput InterflowOutput BaseflowInput BaseflowOutput</span></span>
<span><span class="co">## 2001-01-01              0               0       8.30387       5.665909</span></span></code></pre>
<p>Several plots can be drawn from the result of function
<code><a href="../reference/spwb_land.html">spwb_land()</a></code> in a similar way as done for
<code><a href="../reference/spwb_spatial.html">spwb_spatial()</a></code>. As an example we display a map of soil
water volume for the simulated month:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">res_ws</span><span class="op">$</span><span class="va">sf</span>, <span class="st">"SoilVol"</span>, <span class="st">"2001-01-01"</span><span class="op">)</span></span></code></pre></div>
<p><img src="LandscapeWaterBalance_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Aitor Améztegui.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
