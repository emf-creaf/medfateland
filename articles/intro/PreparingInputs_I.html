<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Preparing inputs I: forest inventory plots • medfateland</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Preparing inputs I: forest inventory plots">
<meta name="description" content="Instructions to create model inputs from forest inventory data
">
<meta property="og:description" content="Instructions to create model inputs from forest inventory data
">
<meta property="og:image" content="https://emf-creaf.github.io/medfateland/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">medfateland</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.5.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../../articles/intro/PackageOverview.html">Package overview</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/PreparingInputs_I.html">Preparing inputs I: forest inventory plots</a></li>
    <li><a class="dropdown-item" href="../../articles/intro/PreparingInputs_II.html">Preparing inputs II: arbitrary locations</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Running simulations</h6></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/SpatiallyUncoupledSimulations.html">Spatially-uncoupled simulations</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/WatershedSimulations.html">Watershed simulations</a></li>
    <li><a class="dropdown-item" href="../../articles/runmodels/ManagementScenarios.html">Management scenarios</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/medfateland/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Preparing inputs I: forest inventory plots</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres / Adriana Tovar / Víctor Granda</h4>
            
            <h4 data-toc-skip class="date">2025-03-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfateland/blob/HEAD/vignettes/intro/PreparingInputs_I.Rmd" class="external-link"><code>vignettes/intro/PreparingInputs_I.Rmd</code></a></small>
      <div class="d-none name"><code>PreparingInputs_I.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="aim">Aim<a class="anchor" aria-label="anchor" href="#aim"></a>
</h2>
<p>This vignette has been created to illustrate the creation of spatial
inputs to be used in model simulations with the package, starting
<strong>from forest inventory plot data</strong>.</p>
<p>Before reading this vignette, users should be familiar with
<em>forest</em> and <em>soil</em> structures in package
<strong>medfate</strong>. Moreover, a brief introduction to spatial
structures used in <strong>medfateland</strong> package is given in
vignette <a href="https://emf-creaf.github.io/medfateland/articles/PackageOverview.html">Package
overview</a> and examples are given in vignettes <a href="https://emf-creaf.github.io/medfateland/articles/SpatiallyUncoupledSimulations.html">Spatially-uncoupled
simulations</a>.</p>
<p>Let’s first load necessary libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/medfate/" class="external-link">medfate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/medfateland/">medfateland</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span></span></code></pre></div>
<p>The first section, <strong>A</strong>, shows how to create the
spatial inputs from forest inventory data in tree lists, which will be
the general case. The second section, <strong>B</strong>, shows the
differences that occur when the starting point is a data structure
issued from package <strong>forestables</strong>. For that part we need
package <strong>forestables</strong> in our environment, because we will
take an example data table from there. The package can be installed from
GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remotes::install_github("emf-creaf/forestables")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/forestables/" class="external-link">forestables</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: data.table</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: dtplyr</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="a--general-procedure">A. General procedure<a class="anchor" aria-label="anchor" href="#a--general-procedure"></a>
</h2>
<p>The functions introduced in this procedure are meant to be executed
sequentially to progressively add spatial information, as illustrated in
the workflow below, but users are free to use them in the most
convenient way.</p>
<p><img src="forest_inventory_init_workflow.png" alt="Initialization workflow for forest inventory data" width="80%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="target-locations">Target locations<a class="anchor" aria-label="anchor" href="#target-locations"></a>
</h3>
<p>Package <strong>medfate</strong> includes a small dataset of tree
data, corresponding to a dense holm oak forest in Poblet (Catalonia,
Spain). As a result of the abandonment of previous coppicing
exploitation, there is a high density of stems per individual. The data
set includes data from a control plot and managed plot, where for the
second two inventories have been carried out, one before management
(thinning operation) and another afterwards. Hence, there are three
stand structures.</p>
<p>We begin by defining an <code>sf</code> object with the target
locations and forest stand identifiers (column <code>id</code>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define sf with three stands</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0215</span>, <span class="fl">41.3432</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0219</span>, <span class="fl">41.3443</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0219</span>, <span class="fl">41.3443</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="va">cc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lat <span class="op">=</span> <span class="va">cc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"POBL_CTL"</span>, <span class="st">"POBL_THI_BEF"</span>, <span class="st">"POBL_THI_AFT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">d</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 3 features and 1 field</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.0215 ymin: 41.3432 xmax: 1.0219 ymax: 41.3443</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">##             id               geometry</span></span>
<span><span class="co">## 1     POBL_CTL POINT (1.0215 41.3432)</span></span>
<span><span class="co">## 2 POBL_THI_BEF POINT (1.0219 41.3443)</span></span>
<span><span class="co">## 3 POBL_THI_AFT POINT (1.0219 41.3443)</span></span></code></pre>
<p>where <code>POBL_CTL</code> is the control forest plot,
<code>POBL_THI_BEF</code> is the managed plot before thinning and
<code>POBL_THI_AFT</code> is the managed plot after thinning.</p>
</div>
<div class="section level3">
<h3 id="topography">Topography<a class="anchor" aria-label="anchor" href="#topography"></a>
</h3>
<p>Once an object <code>sf</code> has been defined with target
locations, we need to determine topographic features (elevation, slope,
aspect) and land cover corresponding to those locations. You should have
access to a Digital Elevation Model (DEM) at a desired resolution. Here
we will use a DEM raster for Catalonia at 30 m resolution, which we load
using package <code>terra</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset_path</span> <span class="op">&lt;-</span> <span class="st">"~/OneDrive/EMF_datasets/"</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"Topography/Products/Catalunya/MET30m_ETRS89_UTM31_ICGC.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dem</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 9282, 9391, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 30, 30  (x, y)</span></span>
<span><span class="co">## extent      : 258097.5, 539827.5, 4485488, 4763948  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : ETRS89 / UTM zone 31N (EPSG:25831) </span></span>
<span><span class="co">## source      : MET30m_ETRS89_UTM31_ICGC.tif </span></span>
<span><span class="co">## name        : met15v20as0f0118Bmr1r050 </span></span>
<span><span class="co">## min value   :                   -7.120 </span></span>
<span><span class="co">## max value   :                 3133.625</span></span></code></pre>
<p>Having these inputs, we can use function
<code><a href="../../reference/add_topography.html">add_topography()</a></code> to add topographic features to our
starting <code>sf</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/add_topography.html">add_topography</a></span><span class="op">(</span><span class="va">x</span>, dem <span class="op">=</span> <span class="va">dem</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_1</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 3 features and 4 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.0215 ymin: 41.3432 xmax: 1.0219 ymax: 41.3443</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   id                   geometry elevation slope aspect</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> POBL_CTL     (1.0215 41.3432)      853.  30.1   76.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> POBL_THI_BEF (1.0219 41.3443)      814.  29.3   40.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> POBL_THI_AFT (1.0219 41.3443)      814.  29.3   40.3</span></span></code></pre>
<p>We can check that there are no missing values in topographic
features:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/check_inputs.html">check_topography</a></span><span class="op">(</span><span class="va">y_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No missing values in topography.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="forest-inventory-data-parsing">Forest inventory data parsing<a class="anchor" aria-label="anchor" href="#forest-inventory-data-parsing"></a>
</h3>
<p>The next step is to define <code>forest</code> objects for our
simulations. Forests should be defined for all target locations whose
land cover is defined as <code>wildland</code> (here, all three stands).
In our case, we will define <code>forest</code> objects from tree
records in Poblet. While at this point you would read your own data from
a file or data base, here we simply load the data from
<strong>medfate</strong>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Plot.Code Indv.Ref             Species Diameter.cm</span></span>
<span><span class="co">## 1  POBL_CTL        1 Acer monspessulanum         7.6</span></span>
<span><span class="co">## 2  POBL_CTL        2       Arbutus unedo         7.5</span></span>
<span><span class="co">## 3  POBL_CTL        3       Arbutus unedo         7.5</span></span>
<span><span class="co">## 4  POBL_CTL        4       Arbutus unedo         7.5</span></span>
<span><span class="co">## 5  POBL_CTL        5       Arbutus unedo         7.5</span></span>
<span><span class="co">## 6  POBL_CTL        6       Arbutus unedo         7.5</span></span></code></pre>
<p>There are only four columns in the data set. <code>Plot.Code</code>
identifies the forest stand, <code>Indv.Ref</code> is the tree number,
<code>Species</code> is the scientific name of the tree species and
<code>Diameter.cm</code> is the tree diameter in cm. To properly parse
forest inventory data, we need to define a mapping from these variables
into names meaningful for <strong>medfate</strong>. For this, we can
check function <code><a href="https://emf-creaf.github.io/medfate/reference/forest_mapWoodyTables.html" class="external-link">forest_mapTreeTable()</a></code> in the package.
Furthermore, we need to map the forest stand identifier. If we exclude
<code>Indv.Ref</code>, the other variables would be mapped using:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"Plot.Code"</span>, <span class="st">"Species.name"</span> <span class="op">=</span> <span class="st">"Species"</span>, <span class="st">"DBH"</span> <span class="op">=</span> <span class="st">"Diameter.cm"</span><span class="op">)</span></span></code></pre></div>
<p>Now we are ready to call function <code><a href="../../reference/add_forests.html">add_forests()</a></code>, which
should facilitate the creation of forest objects:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/add_forests.html">add_forests</a></span><span class="op">(</span><span class="va">y_1</span>, tree_table <span class="op">=</span> <span class="va">poblet_trees</span>, tree_mapping <span class="op">=</span> <span class="va">mapping</span>, </span>
<span>                   SpParams <span class="op">=</span> <span class="va">SpParamsMED</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in forest_mapTreeTable(x = tree_id, mapping_x = tree_mapping, SpParams</span></span>
<span><span class="co">## = SpParams): Taxon names that were not matched: Quercus humilis.</span></span>
<span><span class="co">## Warning in forest_mapTreeTable(x = tree_id, mapping_x = tree_mapping, SpParams</span></span>
<span><span class="co">## = SpParams): Taxon names that were not matched: Quercus humilis.</span></span></code></pre>
<p>Note that two warnings were raised, informing us that <em>Quercus
humilis</em> (downy oak) was not matched to any species name in
<code>SpParamsMED</code> (that is the reason why we provided it as an
input). We correct the scientific name for downy oak and repeat to avoid
losing tree records:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="st">"Quercus humilis"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Quercus pubescens"</span></span>
<span><span class="va">y_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/add_forests.html">add_forests</a></span><span class="op">(</span><span class="va">y_1</span>, tree_table <span class="op">=</span> <span class="va">poblet_trees</span>, tree_mapping <span class="op">=</span> <span class="va">mapping</span>, </span>
<span>                   SpParams <span class="op">=</span> <span class="va">SpParamsMED</span><span class="op">)</span></span>
<span><span class="va">y_2</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 3 features and 5 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.0215 ymin: 41.3432 xmax: 1.0219 ymax: 41.3443</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">##   id                   geometry elevation slope aspect forest      </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> POBL_CTL     (1.0215 41.3432)      853.  30.1   76.0 <span style="color: #949494;">&lt;forest [5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> POBL_THI_BEF (1.0219 41.3443)      814.  29.3   40.3 <span style="color: #949494;">&lt;forest [5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> POBL_THI_AFT (1.0219 41.3443)      814.  29.3   40.3 <span style="color: #949494;">&lt;forest [5]&gt;</span></span></span></code></pre>
<p>The function has added a column <code>forest</code> with the tree
data. We can check the metrics of the first forest stand using:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">y_2</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Tree BA (m2/ha): 3.0179815  adult trees: 3.0179815  saplings: 0 </span></span>
<span><span class="co">## Density (ind/ha) adult trees: 267  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">## Cover (%) adult trees: 42.3272186  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">## LAI (m2/m2) total: 0.5419688  adult trees: 0.5419688  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">## Fuel loading (kg/m2) total: 0.1414227  adult trees: 0.1414227  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">## PAR ground (%): NA  SWR ground (%): NA</span></span></code></pre>
<p>Both density and tree basal area seem unusually low. This is because
we did not specify the sampled area, and tree data in
<code>forest</code> objects require a density estimation. By default,
each record (row in the input data frame) will count as a tree, but we
can add the sampled plot surface to correct density per hectare. In a
15-m radius plot, the sampled surface is 706.86 m2. We add this
information in the data table:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">PlotSurface</span> <span class="op">&lt;-</span> <span class="fl">706.86</span></span></code></pre></div>
<p>and we can repeat the read of forest inventory data after adding a
new element to the mapping vector:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mapping</span>, <span class="st">"plot.size"</span> <span class="op">=</span> <span class="st">"PlotSurface"</span><span class="op">)</span></span>
<span><span class="va">y_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/add_forests.html">add_forests</a></span><span class="op">(</span><span class="va">y_1</span>, tree_table <span class="op">=</span> <span class="va">poblet_trees</span>, tree_mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span><span class="op">)</span></span></code></pre></div>
<p>If we check the forest again, we will see the change in density and
basal area:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">y_2</span><span class="op">$</span><span class="va">forest</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">SpParamsMED</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Tree BA (m2/ha): 42.6956049  adult trees: 42.6956049  saplings: 0 </span></span>
<span><span class="co">## Density (ind/ha) adult trees: 3777.2684832  saplings: 0  shrubs (estimated): 0 </span></span>
<span><span class="co">## Cover (%) adult trees: 100  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">## LAI (m2/m2) total: 4.9189289  adult trees: 4.9189289  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">## Fuel loading (kg/m2) total: 1.2992685  adult trees: 1.2992685  saplings: 0  shrubs: 0  herbs: 0 </span></span>
<span><span class="co">## PAR ground (%): NA  SWR ground (%): NA</span></span></code></pre>
<p>At this point, we may wonder whether we are finished. Function
<code><a href="../../reference/check_inputs.html">check_forests()</a></code> can help detecting missing data:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/check_inputs.html">check_forests</a></span><span class="op">(</span><span class="va">y_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No wildland locations with NULL values in column 'forest'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> All objects in column 'forest' have the right class.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #BBBB00;">!</span> Missing tree height values detected for 28 (100%) in 3 wildland locations (100%).</span></span></code></pre>
<p>The function alerts us that height values are missing. Since they are
required for simulations using <strong>medfate</strong>, we need to
estimate them. While being overly simplistic, here we use one allometric
equation for all species to estimate tree height in cm from
diameter:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Height.cm</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">1.806</span><span class="op">*</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Diameter.cm</span><span class="op">^</span><span class="fl">0.518</span></span></code></pre></div>
<p>Now we modify the mapping to include height and repeat the reading
operation:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mapping</span>, <span class="st">"Height"</span> <span class="op">=</span> <span class="st">"Height.cm"</span><span class="op">)</span></span>
<span><span class="va">y_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/add_forests.html">add_forests</a></span><span class="op">(</span><span class="va">y_1</span>, tree_table <span class="op">=</span> <span class="va">poblet_trees</span>, tree_mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span><span class="op">)</span></span></code></pre></div>
<p>If we check the forest data again, we should encounter no more
issues:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/check_inputs.html">check_forests</a></span><span class="op">(</span><span class="va">y_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No wildland locations with NULL values in column 'forest'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> All objects in column 'forest' have the right class.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No missing/wrong values detected in key tree/shrub attributes of 'forest' objects.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="soil-parameterization">Soil parameterization<a class="anchor" aria-label="anchor" href="#soil-parameterization"></a>
</h3>
<p>Soil information is most usually lacking for the target locations.
Regional maps of soil properties may be available in some cases. Here we
assume this information is not available, so that we resort to global
products. In particular, we will use information provided in <a href="https://soilgrids.org/" class="external-link">SoilGrids</a> at 250 m resolution (<a href="https://doi.org/10.1371/journal.pone.0169748" class="external-link">Hengl et
al. (2017)</a>; <a href="https://doi.org/10.5194/soil-7-217-2021" class="external-link">Poggio
et al. (2021)</a>).</p>
<div class="section level4">
<h4 id="soilgrids-2-0-data">SoilGrids 2.0 data<a class="anchor" aria-label="anchor" href="#soilgrids-2-0-data"></a>
</h4>
<p>Function <code><a href="../../reference/soil_parametrization.html">add_soilgrids()</a></code> can perform queries using the
REST API of SoilGrids, but this becomes problematic for multiple sites.
Hence, we recommend downloading SoilGrid rasters for the target region
and storing them in a particular format, so that function
<code><a href="../../reference/soil_parametrization.html">add_soilgrids()</a></code> can read them (check the details of the
function documentation). The extraction of SoilGrids data for our target
locations is fast using this approach:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soilgrids_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>,<span class="st">"Soils/Sources/Global/SoilGrids/Spain/"</span><span class="op">)</span></span>
<span><span class="va">y_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil_parametrization.html">add_soilgrids</a></span><span class="op">(</span><span class="va">y_2</span>, soilgrids_path <span class="op">=</span> <span class="va">soilgrids_path</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>And the result has an extra column <code>soil</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_3</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 3 features and 6 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.0215 ymin: 41.3432 xmax: 1.0219 ymax: 41.3443</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">##   id                   geometry elevation slope aspect forest       soil        </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> POBL_CTL     (1.0215 41.3432)      853.  30.1   76.0 <span style="color: #949494;">&lt;forest [5]&gt;</span> <span style="color: #949494;">&lt;df [6 × 7]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> POBL_THI_BEF (1.0219 41.3443)      814.  29.3   40.3 <span style="color: #949494;">&lt;forest [5]&gt;</span> <span style="color: #949494;">&lt;df [6 × 7]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> POBL_THI_AFT (1.0219 41.3443)      814.  29.3   40.3 <span style="color: #949494;">&lt;forest [5]&gt;</span> <span style="color: #949494;">&lt;df [6 × 7]&gt;</span></span></span></code></pre>
<p>The elements of the list are the usual data frames of soil properties
in <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_3</span><span class="op">$</span><span class="va">soil</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths clay sand   om   bd  rfc nitrogen</span></span>
<span><span class="co">## 1     50 25.3 32.1 7.24 1.05 16.8     5.07</span></span>
<span><span class="co">## 2    100 25.5 32.0 3.10 1.16 18.7     2.18</span></span>
<span><span class="co">## 3    150 29.9 31.2 1.96 1.25 19.8     1.35</span></span>
<span><span class="co">## 4    300 30.7 30.7 1.00 1.39 19.6     0.81</span></span>
<span><span class="co">## 5    400 30.4 30.2 0.89 1.49 20.4     0.58</span></span>
<span><span class="co">## 6   1000 32.0 30.2 0.62 1.50 21.5     0.44</span></span></code></pre>
<p>We can use function <code><a href="../../reference/check_inputs.html">check_soils()</a></code> to detect whether
there are missing values:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/check_inputs.html">check_soils</a></span><span class="op">(</span><span class="va">y_3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No wildland/agriculture locations with NULL values in column 'soil'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No missing values detected in key soil attributes.</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="soil-depth-and-rock-content-modification">Soil depth and rock content modification<a class="anchor" aria-label="anchor" href="#soil-depth-and-rock-content-modification"></a>
</h4>
<p>SoilGrids 2.0 does not provide information on soil depth, and rock
fragment content is normally underestimated, which leads to an
overestimation of water holding capacity. Function
<code><a href="../../reference/soil_parametrization.html">modify_soils()</a></code> allows modifying soil definitions, if
information is available for soil depth, depth to the (unaltered)
bedrock, or both. Soil depth maps are not common in many regions, so
here we will resort on a global product at 250m-resolution by <a href="https://doi.org/10.1002/2016MS000686" class="external-link">Shangguan et al. (2017)</a>,
which consists on three rasters:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Censored soil depth (cm)</span></span>
<span><span class="va">bdricm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>, <span class="st">"Soils/Sources/Global/SoilDepth_Shangguan2017/BDRICM_M_250m_ll.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Probability of bedrock within first 2m [0-100]</span></span>
<span><span class="va">bdrlog</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>, <span class="st">"Soils/Sources/Global/SoilDepth_Shangguan2017/BDRLOG_M_250m_ll.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Absolute depth to bedrock (cm)</span></span>
<span><span class="va">bdticm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataset_path</span>, <span class="st">"Soils/Sources/Global/SoilDepth_Shangguan2017/BDTICM_M_250m_ll.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In order to accelerate raster manipulations, we crop the global
rasters to the extent of the target area:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_vect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">bdricm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x_ext</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">x_vect</span><span class="op">)</span></span>
<span><span class="va">bdricm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">bdricm</span>, <span class="va">x_ext</span>, snap <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span><span class="va">bdrlog</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">bdrlog</span>, <span class="va">x_ext</span>, snap <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span><span class="va">bdticm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">bdticm</span>, <span class="va">x_ext</span>, snap <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span></code></pre></div>
<p>Censored soil depth is a poor product of actual soil depth, but we
have observed a fairly good correlation between soil depth values in
Catalonia and the probability of finding the bedrock within the first
two meters. Hence, we multiply the two layers and use it as a (crude)
estimate of soil depth, expressing it in mm:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soil_depth_mm</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">bdricm</span><span class="op">$</span><span class="va">BDRICM_M_250m_ll</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="va">bdrlog</span><span class="op">$</span><span class="va">BDRLOG_M_250m_ll</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and we take the depth to bedrock as appropriate, but change its units
to mm as well:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depth_to_bedrock_mm</span> <span class="op">&lt;-</span> <span class="va">bdticm</span><span class="op">*</span><span class="fl">10</span></span></code></pre></div>
<p>We can now call function <code><a href="../../reference/soil_parametrization.html">modify_soils()</a></code> with the two
rasters to perform the correction of soil characteristics:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil_parametrization.html">modify_soils</a></span><span class="op">(</span><span class="va">y_3</span>, </span>
<span>                    soil_depth_map <span class="op">=</span> <span class="va">soil_depth_mm</span>, </span>
<span>                    depth_to_bedrock_map <span class="op">=</span> <span class="va">depth_to_bedrock_mm</span>,</span>
<span>                    progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In this case, the depth to bedrock values were deeper than 2m, so
that only the soil depth map had an effect on the correction procedure.
After the correction, the rock fragment content of the soil has changed
substantially:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_4</span><span class="op">$</span><span class="va">soil</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   widths clay sand   om   bd      rfc nitrogen</span></span>
<span><span class="co">## 1     50 25.3 32.1 7.24 1.05 16.80000     5.07</span></span>
<span><span class="co">## 2    100 25.5 32.0 3.10 1.16 18.70000     2.18</span></span>
<span><span class="co">## 3    150 29.9 31.2 1.96 1.25 19.80000     1.35</span></span>
<span><span class="co">## 4    300 30.7 30.7 1.00 1.39 27.76899     0.81</span></span>
<span><span class="co">## 5    400 30.4 30.2 0.89 1.49 49.36709     0.58</span></span>
<span><span class="co">## 6   1000 32.0 30.2 0.62 1.50 92.56329     0.44</span></span></code></pre>
<p>Finally, we can call again <code><a href="../../reference/check_inputs.html">check_soils()</a></code> to verify that
everything is fine:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/check_inputs.html">check_soils</a></span><span class="op">(</span><span class="va">y_4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No wildland/agriculture locations with NULL values in column 'soil'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No missing values detected in key soil attributes.</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="initialization-test">Initialization test<a class="anchor" aria-label="anchor" href="#initialization-test"></a>
</h3>
<p>We can check whether the input data set is well formed by calling
function <code><a href="../../reference/initialize_landscape.html">initialize_landscape()</a></code>:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/initialize_landscape.html">initialize_landscape</a></span><span class="op">(</span><span class="va">y_4</span>, <span class="va">SpParamsMED</span>, <span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/defaultControl.html" class="external-link">defaultControl</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 3 features and 7 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.0215 ymin: 41.3432 xmax: 1.0219 ymax: 41.3443</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 8</span></span></span>
<span><span class="co">##   id                   geometry elevation slope aspect forest       soil        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> POBL_CTL     (1.0215 41.3432)      853.  30.1   76.0 <span style="color: #949494;">&lt;forest [5]&gt;</span> <span style="color: #949494;">&lt;df [6 × 7]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> POBL_THI_BEF (1.0219 41.3443)      814.  29.3   40.3 <span style="color: #949494;">&lt;forest [5]&gt;</span> <span style="color: #949494;">&lt;df [6 × 7]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> POBL_THI_AFT (1.0219 41.3443)      814.  29.3   40.3 <span style="color: #949494;">&lt;forest [5]&gt;</span> <span style="color: #949494;">&lt;df [6 × 7]&gt;</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: state &lt;list&gt;</span></span></span></code></pre>
<p>Everything seems fine for simulations!</p>
</div>
</div>
<div class="section level2">
<h2 id="b--procedure-from-forestables">B. Procedure from forestables<a class="anchor" aria-label="anchor" href="#b--procedure-from-forestables"></a>
</h2>
<p>R package <a href="https://emf-creaf.github.io/forestables/" class="external-link"><strong>forestables</strong></a>
allows reading and harmonizing national forest inventory data from the
FIA (USA forest inventory), FFI (France forest inventory) and IFN (Spain
forest inventory). When an data issued from this package is the starting
point to create spatial inputs for <strong>medfateland</strong>, the
general procedure is simplified, as shown below:</p>
<div class="section level3">
<h3 id="example-dataset">Example dataset<a class="anchor" aria-label="anchor" href="#example-dataset"></a>
</h3>
<p>To illustrate this procedure, we first load an example data set given
in the <strong>forestables</strong> package for the Spanish national
forest inventory:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ifn_output_example"</span><span class="op">)</span></span>
<span><span class="va">ifn_output_example</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 8,997 × 24</span></span></span>
<span><span class="co">##    id_unique_code    year plot  coordx coordy coord_sys   crs  elev aspect slope</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 08_0001_NN_A1_A1  <span style="text-decoration: underline;">1</span>990 0001  <span style="text-decoration: underline;">402</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>900     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 08_0002_NN_A1_A1  <span style="text-decoration: underline;">1</span>990 0002  <span style="text-decoration: underline;">400</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>700     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 08_0003_NN_A1_A1  <span style="text-decoration: underline;">1</span>990 0003  <span style="text-decoration: underline;">401</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>700     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 08_0004_NN_A1_A1  <span style="text-decoration: underline;">1</span>990 0004  <span style="text-decoration: underline;">402</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>400     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 08_0005_NN_A1_A1  <span style="text-decoration: underline;">1</span>990 0005  <span style="text-decoration: underline;">400</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>300     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 08_0006_NN_A1_A1  <span style="text-decoration: underline;">1</span>990 0006  <span style="text-decoration: underline;">397</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>700     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 08_0007_NN_A1_xx  <span style="text-decoration: underline;">1</span>990 0007  <span style="text-decoration: underline;">399</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>400     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 08_0008_NN_A1_xx  <span style="text-decoration: underline;">1</span>990 0008  <span style="text-decoration: underline;">401</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>100     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 08_0009_NN_A1_xx  <span style="text-decoration: underline;">1</span>990 0009  <span style="text-decoration: underline;">402</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>100     52    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 08_0010_NN_A1_xx  <span style="text-decoration: underline;">1</span>990 0010  <span style="text-decoration: underline;">394</span>000 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031  <span style="text-decoration: underline;">1</span>500     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 8,987 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 14 more variables: country &lt;chr&gt;, version &lt;chr&gt;, class &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   subclass &lt;chr&gt;, province_code &lt;chr&gt;, province_name_original &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ca_name_original &lt;chr&gt;, sheet_ntm &lt;chr&gt;, huso &lt;dbl&gt;, slope_mean &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   type &lt;int&gt;, tree &lt;list&gt;, understory &lt;list&gt;, regen &lt;list&gt;</span></span></span></code></pre>
<p>The dataset contains data from different forest inventory
surveys:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ifn_output_example</span><span class="op">$</span><span class="va">version</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## ifn2 ifn3 ifn4 </span></span>
<span><span class="co">## 3542 3769 1686</span></span></code></pre>
<p>Here we will use only data from the last survey (IFN4):</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ifn4_example</span> <span class="op">&lt;-</span> <span class="va">ifn_output_example</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">version</span> <span class="op">==</span> <span class="st">"ifn4"</span><span class="op">)</span></span>
<span><span class="va">ifn4_example</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,686 × 24</span></span></span>
<span><span class="co">##    id_unique_code    year plot  coordx coordy coord_sys   crs  elev aspect slope</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 08_0001_NN_A1_A1  <span style="text-decoration: underline;">2</span>015 0001  <span style="text-decoration: underline;">401</span>922 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>   202.    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 08_0002_NN_A1_A1  <span style="text-decoration: underline;">2</span>014 0002  <span style="text-decoration: underline;">399</span>895 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>   342     40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 08_0003_NN_A1_A1  <span style="text-decoration: underline;">2</span>015 0003  <span style="text-decoration: underline;">400</span>898 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>    99     40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 08_0004_NN_A1_A1  <span style="text-decoration: underline;">2</span>014 0004  <span style="text-decoration: underline;">401</span>903 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>   292.    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 08_0005_NN_A1_A1  <span style="text-decoration: underline;">2</span>014 0005  <span style="text-decoration: underline;">399</span>917 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>    99     40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 08_0006_NN_A1_A1  <span style="text-decoration: underline;">2</span>014 0006  <span style="text-decoration: underline;">396</span>931 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>   351     40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 08_0009_xx_xx_A4  <span style="text-decoration: underline;">2</span>016 0009  <span style="text-decoration: underline;">401</span>899 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>    90     40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 08_0014_NN_A1_A1  <span style="text-decoration: underline;">2</span>015 0014  <span style="text-decoration: underline;">397</span>927 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>   234     40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 08_0016_xx_xx_A4  <span style="text-decoration: underline;">2</span>014 0016  <span style="text-decoration: underline;">392</span>906 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>   346.    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 08_0020_NN_A1_A1  <span style="text-decoration: underline;">2</span>015 0020  <span style="text-decoration: underline;">397</span>842 4.68<span style="color: #949494;">e</span>6 ED50      <span style="text-decoration: underline;">23</span>031    <span style="color: #BB0000;">NA</span>    36     40</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,676 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 14 more variables: country &lt;chr&gt;, version &lt;chr&gt;, class &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   subclass &lt;chr&gt;, province_code &lt;chr&gt;, province_name_original &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ca_name_original &lt;chr&gt;, sheet_ntm &lt;chr&gt;, huso &lt;dbl&gt;, slope_mean &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   type &lt;int&gt;, tree &lt;list&gt;, understory &lt;list&gt;, regen &lt;list&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="parsing-forestable-data">Parsing forestable data<a class="anchor" aria-label="anchor" href="#parsing-forestable-data"></a>
</h3>
<p>Function <code><a href="../../reference/parse_forestable.html">parse_forestable()</a></code> allows parsing a data frame
(or sf) issued from package <strong>forestables</strong> and reshaping
it for <strong>medfateland</strong>. In this example we will only
transform the first 100 rows:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/parse_forestable.html">parse_forestable</a></span><span class="op">(</span><span class="va">ifn4_example</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">y_1</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 100 features and 9 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.689588 ymin: 42.14464 xmax: 2.041199 ymax: 42.29967</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 100 × 10</span></span></span>
<span><span class="co">##    id                 geometry  year plot  country version elevation slope</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;POINT [°]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 08_000… (1.809049 42.29746)  <span style="text-decoration: underline;">2</span>015 0001  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 08_000… (1.784615 42.28933)  <span style="text-decoration: underline;">2</span>014 0002  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 08_000… (1.796778 42.28951)  <span style="text-decoration: underline;">2</span>015 0003  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 08_000… (1.808973 42.28922)  <span style="text-decoration: underline;">2</span>014 0004  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 08_000…  (1.78507 42.27957)  <span style="text-decoration: underline;">2</span>014 0005  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 08_000… (1.749026 42.27098)  <span style="text-decoration: underline;">2</span>014 0006  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 08_000…  (1.809255 42.2717)  <span style="text-decoration: underline;">2</span>016 0009  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 08_001… (1.761288 42.26155)  <span style="text-decoration: underline;">2</span>015 0014  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 08_001… (1.700605 42.25216)  <span style="text-decoration: underline;">2</span>014 0016  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 08_002… (1.760416 42.25344)  <span style="text-decoration: underline;">2</span>015 0020  ES      ifn4           <span style="color: #BB0000;">NA</span>    40</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 90 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: aspect &lt;dbl&gt;, forest &lt;list&gt;</span></span></span></code></pre>
<p>As can be seen from the output, the function parsed plot ids, plot
coordinates, and topography. Importantly, it defined a new column called
<code>forest</code> and parsed tree and shrub data into it.</p>
<p>If we check the forest data, we may encounter issues to be
solved:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/check_inputs.html">check_forests</a></span><span class="op">(</span><span class="va">y_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No wildland locations with NULL values in column 'forest'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> All objects in column 'forest' have the right class.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No missing/wrong values detected in key tree/shrub attributes of 'forest' objects.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="remaining-steps">Remaining steps<a class="anchor" aria-label="anchor" href="#remaining-steps"></a>
</h3>
<p>The remaining steps are similar to the general procedure, but are
repeated here for completeness.</p>
<p><strong>Topography data</strong></p>
<p>Topographic information in national forest inventory data can contain
a lot of missing values. It is normally preferrable to extract
topographic features from a digital elevation model (although the error
in plot coordinates adds uncertainty into the result):</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/add_topography.html">add_topography</a></span><span class="op">(</span><span class="va">y_1</span>, dem <span class="op">=</span> <span class="va">dem</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span></code></pre>
<p><strong>Soil data</strong></p>
<p>Soil data is not normally sampled in national forest inventory data,
or it is difficult to harmonize. Therefore, we will normally resort on
SoilGrids as before:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil_parametrization.html">add_soilgrids</a></span><span class="op">(</span><span class="va">y_2</span>, soilgrids_path <span class="op">=</span> <span class="va">soilgrids_path</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We can now call function <code><a href="../../reference/soil_parametrization.html">modify_soils()</a></code> with the two
rasters to perform the correction of soil characteristics:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/soil_parametrization.html">modify_soils</a></span><span class="op">(</span><span class="va">y_3</span>, </span>
<span>                    soil_depth_map <span class="op">=</span> <span class="va">soil_depth_mm</span>, </span>
<span>                    depth_to_bedrock_map <span class="op">=</span> <span class="va">depth_to_bedrock_mm</span>,</span>
<span>                    progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can call <code><a href="../../reference/check_inputs.html">check_soils()</a></code> to verify that
everything is fine:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/check_inputs.html">check_soils</a></span><span class="op">(</span><span class="va">y_4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No wildland/agriculture locations with NULL values in column 'soil'.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> No missing values detected in key soil attributes.</span></span></code></pre>
<p><strong>Initialization test</strong></p>
<p>At this point we should test the initialization. Here, however, we
should use an <code>SpParams</code> data frame having all the species
mentioned in the forest inventory data.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Aitor Améztegui, María González, Núria Aquilué, Daniel Caviedes-Voullième, Mario Morales-Hernández.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
