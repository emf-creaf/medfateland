<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Landscape forest parametrization — forest_parametrization • medfateland</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Landscape forest parametrization — forest_parametrization"><meta name="description" content="Utility functions to define forest inputs in a landscape:
impute_forests() performs imputation of forest objects from a forest inventory using a forest map to match forest types and topography as covariates.
modify_forest_structure() uses forest structure rasters supplied by the user to correct forest structure metrics.
check_forests() checks that forests are defined and do not contain missing values in key tree/shrub attributes.

"><meta property="og:description" content="Utility functions to define forest inputs in a landscape:
impute_forests() performs imputation of forest objects from a forest inventory using a forest map to match forest types and topography as covariates.
modify_forest_structure() uses forest structure rasters supplied by the user to correct forest structure metrics.
check_forests() checks that forests are defined and do not contain missing values in key tree/shrub attributes.

"><meta property="og:image" content="https://emf-creaf.github.io/medfateland/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">medfateland</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.6.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/intro/PackageOverview.html">Package overview</a></li>
    <li><a class="dropdown-item" href="../articles/intro/PreparingInputs_I.html">Preparing inputs I: forest inventory plots</a></li>
    <li><a class="dropdown-item" href="../articles/intro/PreparingInputs_II.html">Preparing inputs II: arbitrary locations</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Running simulations</h6></li>
    <li><a class="dropdown-item" href="../articles/runmodels/SpatiallyUncoupledSimulations.html">Spatially-uncoupled simulations</a></li>
    <li><a class="dropdown-item" href="../articles/runmodels/WatershedSimulations.html">Watershed simulations</a></li>
    <li><a class="dropdown-item" href="../articles/runmodels/ManagementScenarios.html">Management scenarios</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/medfateland/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Landscape forest parametrization</h1>
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfateland/blob/HEAD/R/impute_forests.R" class="external-link"><code>R/impute_forests.R</code></a></small>
      <div class="d-none name"><code>forest_parametrization.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Utility functions to define forest inputs in a landscape:</p><ul><li><p><code>impute_forests()</code> performs imputation of forest objects from a forest inventory using a forest map to match forest types and topography as covariates.</p></li>
<li><p><code>modify_forest_structure()</code> uses forest structure rasters supplied by the user to correct forest structure metrics.</p></li>
<li><p><code><a href="check_inputs.html">check_forests()</a></code> checks that forests are defined and do not contain missing values in key tree/shrub attributes.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">impute_forests</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">sf_fi</span>,</span>
<span>  <span class="va">dem</span>,</span>
<span>  <span class="va">forest_map</span>,</span>
<span>  var_class <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  max_distance_km <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  replace_existing <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  missing_class_imputation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  missing_class_forest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  merge_trees <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  merge_shrubs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">modify_forest_structure</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">structure_map</span>,</span>
<span>  <span class="va">variable</span>,</span>
<span>  map_var <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  ratio_limits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  minDBH <span class="op">=</span> <span class="fl">7.5</span>,</span>
<span>  biomass_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  biomass_arguments <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An object of class <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code>. If it contains a column named 'land_cover_type', imputation
will be performed for locations whose land cover is "wildland". Otherwise, forest imputation is done for all locations.
For structural corrections or when checking, <code>x</code> should already contain a column named 'forest' containing  <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> objects.</p></dd>


<dt id="arg-sf-fi">sf_fi<a class="anchor" aria-label="anchor" href="#arg-sf-fi"></a></dt>
<dd><p>An object of class <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> with forest inventory data column 'forest'.</p></dd>


<dt id="arg-dem">dem<a class="anchor" aria-label="anchor" href="#arg-dem"></a></dt>
<dd><p>A digital elevation model (class <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">SpatRaster</a></code>) with meters as units</p></dd>


<dt id="arg-forest-map">forest_map<a class="anchor" aria-label="anchor" href="#arg-forest-map"></a></dt>
<dd><p>An object of class <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">SpatRaster</a></code> or <code><a href="https://rspatial.github.io/terra/reference/SpatVector-class.html" class="external-link">SpatVector</a></code> with the forest class map</p></dd>


<dt id="arg-var-class">var_class<a class="anchor" aria-label="anchor" href="#arg-var-class"></a></dt>
<dd><p>Variable name or index containing forest classes in <code>forest_map</code>. If missing the first column is taken.</p></dd>


<dt id="arg-max-distance-km">max_distance_km<a class="anchor" aria-label="anchor" href="#arg-max-distance-km"></a></dt>
<dd><p>Maximum distance, in km, for forest inventory plot imputation.</p></dd>


<dt id="arg-replace-existing">replace_existing<a class="anchor" aria-label="anchor" href="#arg-replace-existing"></a></dt>
<dd><p>A logical flag to force the replacement of existing <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> objects, when present.</p></dd>


<dt id="arg-missing-class-imputation">missing_class_imputation<a class="anchor" aria-label="anchor" href="#arg-missing-class-imputation"></a></dt>
<dd><p>A logical flag to force imputation in locations where forest class is not defined. If <code>missing_class_imputation = TRUE</code>, imputation in those locations will be based on geographic and topographic criteria only.</p></dd>


<dt id="arg-missing-class-forest">missing_class_forest<a class="anchor" aria-label="anchor" href="#arg-missing-class-forest"></a></dt>
<dd><p>A <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> object to be used for locations with missing class.</p></dd>


<dt id="arg-merge-trees">merge_trees<a class="anchor" aria-label="anchor" href="#arg-merge-trees"></a></dt>
<dd><p>A logical flag to simplify tree cohorts by merging tree records in DBH classes (see <code><a href="https://emf-creaf.github.io/medfate/reference/forest_simplification.html" class="external-link">forest_mergeTrees</a></code>).</p></dd>


<dt id="arg-merge-shrubs">merge_shrubs<a class="anchor" aria-label="anchor" href="#arg-merge-shrubs"></a></dt>
<dd><p>A logical flag to simplify shrub cohorts by merging shrub records in height classes (see <code><a href="https://emf-creaf.github.io/medfate/reference/forest_simplification.html" class="external-link">forest_mergeShrubs</a></code>).</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>A logical flag to print console output.</p></dd>


<dt id="arg-structure-map">structure_map<a class="anchor" aria-label="anchor" href="#arg-structure-map"></a></dt>
<dd><p>An object of class <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">SpatRaster</a></code> or <code><a href="https://rspatial.github.io/terra/reference/SpatVector-class.html" class="external-link">SpatVector</a></code> with a forest structural variable map</p></dd>


<dt id="arg-variable">variable<a class="anchor" aria-label="anchor" href="#arg-variable"></a></dt>
<dd><p>Structural variable to correct. See options in details.</p></dd>


<dt id="arg-map-var">map_var<a class="anchor" aria-label="anchor" href="#arg-map-var"></a></dt>
<dd><p>Variable name or index containing structural variable in 'structure_map'. If missing the first column is taken.</p></dd>


<dt id="arg-ratio-limits">ratio_limits<a class="anchor" aria-label="anchor" href="#arg-ratio-limits"></a></dt>
<dd><p>Limits for ratio of variable in corrections, used to avoid outliers.</p></dd>


<dt id="arg-mindbh">minDBH<a class="anchor" aria-label="anchor" href="#arg-mindbh"></a></dt>
<dd><p>Minimum diameter for stand metric calculation. If <code>minDBH &gt; 0</code> then those stands with smaller trees will not be corrected
because of the missing stand metric. A special case occurs for correction following basal area (see details).</p></dd>


<dt id="arg-biomass-function">biomass_function<a class="anchor" aria-label="anchor" href="#arg-biomass-function"></a></dt>
<dd><p>A function accepting a forest object or a tree data table (as parameter name <code>x</code>), and a species parameter table (as parameter name <code>SpParams</code>), as input and
returning the aboveground tree biomass (Mg/ha) of the forest stand. The function may accept additional arguments. Needed if <code>variable = "aboveground_tree_biomass"</code>.</p></dd>


<dt id="arg-biomass-arguments">biomass_arguments<a class="anchor" aria-label="anchor" href="#arg-biomass-arguments"></a></dt>
<dd><p>List with additional arguments to be supplied to the biomass function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Functions <code>impute_forests()</code> and <code>modify_forest_structure()</code> return a modified object of class <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code>.
Function <code><a href="check_inputs.html">check_forests()</a></code> returns an invisible data frame with columns indicating missing forest data and missing values in tree or shrub parameters.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Function <code>impute_forests()</code> performs imputation of forest inventory plots on target locations provided that
they correspond to the same forest class, defined in the input forest map, and are geographically closer than a distance threshold (<code>max_distance_km</code>).
Among the multiple stands that can have fulfill these two requirements, the function chooses the one that has the most similar elevation
and position in the N-to-S slopes (i.e. the product of the cosine of aspect and slope). Both topographic
features are standardized to zero mean and unit standard deviation (using the supplied digital elevation model to calculate those metrics), to make their
weight on the imputation equal. This imputation method will be more or less successful depending on the resolution of forest classes and
the number of forest inventory plots available for each of them. Additionally, tree and shrub cohorts can be simplified after imputation (<code>merge_trees</code> and <code>merge_shrubs</code>),
to reduce the number of records (and hence, speed-up simulations).</p>
<p>Function <code>modify_forest_structure()</code> can be used to modify specific structure variables of the imputed forests
building on rasters supplied by the user (typically from aerial or satellite LiDAR products). For any given metric,
the function will calculate the ratio of the structure metric between the target <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> object (see <code><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_basalArea</a></code>)
and the input map in the target location. Options for structural variables are the following:</p><ul><li><p><code>mean_tree_height</code>: Should contain values in cm. Corrects tree heights and diameters (assuming a constant diameter-height relationship).</p></li>
<li><p><code>dominant_tree_height</code>: Should contain values in cm. Corrects tree heights and diameters (assuming a constant diameter-height relationship).</p></li>
<li><p><code>tree_density</code>: Should contain values in individuals per hectare. Corrects tree density.</p></li>
<li><p><code>basal_area</code>: Should contain values in squared meters per hectare (m2/ha). Corrects tree density.</p></li>
<li><p><code>aboveground_tree_biomass</code>: Should contain values in tons per hectare (Mg/ha) of aboveground tree dry weight. Corrects tree density.</p></li>
</ul><p>Locations where the metric value in the map is missing are left unmodified. The same happens if metric value is zero, to avoid division by zero. A special case occurs
for correction of basal area or aboveground tree biomass. In those cases, if there are no trees larger than <code>minDBH</code> but structural map indicates positive values of basal area or aboveground tree biomass,
DBH values will be set to minDBH, and correction will be performed.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="add_topography.html">add_topography()</a></code>, <code><a href="add_forests.html">add_forests()</a></code>, <code><a href="soil_parametrization.html">add_soilgrids()</a></code>, <code><a href="https://emf-creaf.github.io/medfate/reference/forest_simplification.html" class="external-link">forest_mergeTrees</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Miquel De Cáceres Ainsa, CREAF</p>
<p>Rodrigo Balaguer-Romano, CREAF</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># See package vignettes 'Preparing inputs'</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Aitor Améztegui, María González, Núria Aquilué, Daniel Caviedes-Voullième, Mario Morales-Hernández.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

