<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Landscape forest parametrization — forest_parametrization • medfateland</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Landscape forest parametrization — forest_parametrization"><meta property="og:description" content="Utility functions to define forest inputs in a landscape:
impute_forests() performs imputation of forest objects from a forest inventory using a forest map to match forest types and topography as covariates.
modify_forest_structure() uses forest structure rasters supplied by the user to correct forest structure metrics.
check_forests() checks that forests are defined and do not contain missing values in key tree/shrub attributes.

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Landscape forest parametrization</h1>
    
    <div class="hidden name"><code>forest_parametrization.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Utility functions to define forest inputs in a landscape:</p><ul><li><p><code>impute_forests()</code> performs imputation of forest objects from a forest inventory using a forest map to match forest types and topography as covariates.</p></li>
<li><p><code>modify_forest_structure()</code> uses forest structure rasters supplied by the user to correct forest structure metrics.</p></li>
<li><p><code>check_forests()</code> checks that forests are defined and do not contain missing values in key tree/shrub attributes.</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">impute_forests</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">sf_fi</span>,</span>
<span>  <span class="va">dem</span>,</span>
<span>  <span class="va">forest_map</span>,</span>
<span>  var_class <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  max_distance_km <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  replace_existing <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  missing_class_imputation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  missing_class_forest <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  merge_trees <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  merge_shrubs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">modify_forest_structure</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">structure_map</span>,</span>
<span>  <span class="va">variable</span>,</span>
<span>  map_var <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  ratio_limits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  minDBH <span class="op">=</span> <span class="fl">7.5</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">check_forests</span><span class="op">(</span><span class="va">x</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>An object of class <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code>. If it contains a column named 'land_cover_type', imputation
will be performed for locations whose land cover is "wildland". Otherwise, forest imputation is done for all locations.
For structural corrections or when checking, <code>x</code> should already contain a column named 'forest' containing  <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> objects.</p></dd>


<dt>sf_fi</dt>
<dd><p>An object of class <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code> with forest inventory data column 'forest'.</p></dd>


<dt>dem</dt>
<dd><p>A digital elevation model (class <code>rast</code>) with meters as units</p></dd>


<dt>forest_map</dt>
<dd><p>An object of class <code>rast</code> or <code>vect</code> with the forest class map</p></dd>


<dt>var_class</dt>
<dd><p>Variable name or index containing forest classes in <code>forest_map</code>. If missing the first column is taken.</p></dd>


<dt>max_distance_km</dt>
<dd><p>Maximum distance, in km, for forest inventory plot imputation.</p></dd>


<dt>replace_existing</dt>
<dd><p>A logical flag to force the replacement of existing <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> objects, when present.</p></dd>


<dt>missing_class_imputation</dt>
<dd><p>A logical flag to force imputation in locations where forest class is not defined. If <code>missing_class_imputation = TRUE</code>, imputation in those locations will be based on geographic and topographic criteria only.</p></dd>


<dt>missing_class_forest</dt>
<dd><p>A <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> object to be used for locations with missing class.</p></dd>


<dt>merge_trees</dt>
<dd><p>A logical flag to simplify tree cohorts by merging tree records in DBH classes (see <code><a href="https://emf-creaf.github.io/medfate/reference/forest_mergeTrees.html" class="external-link">forest_mergeTrees</a></code>).</p></dd>


<dt>merge_shrubs</dt>
<dd><p>A logical flag to simplify shrub cohorts by merging shrub records in height classes (see <code><a href="https://emf-creaf.github.io/medfate/reference/forest_mergeTrees.html" class="external-link">forest_mergeShrubs</a></code>).</p></dd>


<dt>progress</dt>
<dd><p>A logical flag to print console output.</p></dd>


<dt>structure_map</dt>
<dd><p>An object of class <code>rast</code> or <code>vect</code> with a forest structural variable map</p></dd>


<dt>variable</dt>
<dd><p>Structural variable to correct. See options in details.</p></dd>


<dt>map_var</dt>
<dd><p>Variable name or index containing structural variable in 'structure_map'. If missing the first column is taken.</p></dd>


<dt>ratio_limits</dt>
<dd><p>Limits for ratio of variable in corrections, used to avoid outliers.</p></dd>


<dt>minDBH</dt>
<dd><p>Minimum diameter for stand metric calculation. If <code>minDBH &gt; 0</code> then those stands with smaller trees will not be corrected
because of the missing stand metric.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Functions <code>impute_forests()</code> and <code>modify_forest_structure()</code> return a modified object of class <code><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a></code>.
Function <code>check_forests()</code> returns an invisible data frame with columns indicating missing forest data and missing values in tree or shrub parameters.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Function <code>impute_forests()</code> performs imputation of forest inventory plots on target locations provided that
they correspond to the same forest class, defined in the input forest map, and are geographically closer than a distance threshold (<code>max_distance_km</code>).
Among the multiple stands that can have fulfill these two requirements, the function chooses the one that has the most similar elevation
and position in the N-to-S slopes (i.e. the product of the cosine of aspect and slope). Both topographic
features are standardized to zero mean and unit standard deviation (using the supplied digital elevation model to calculate those metrics), to make their
weight on the imputation equal. This imputation method will be more or less successful depending on the resolution of forest classes and
the number of forest inventory plots available for each of them. Additionally, tree and shrub cohorts can be simplified after imputation (<code>merge_trees</code> and <code>merge_shrubs</code>),
to reduce the number of records (and hence, speed-up simulations).</p>
<p>Function <code>modify_forest_structure()</code> can be used to modify specific structure variables of the imputed forests
building on rasters supplied by the user (typically from aerial or satellite LiDAR products). For any given metric,
the function will calculate the ratio of the structure metric between the target <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> object (see <code><a href="https://emf-creaf.github.io/medfate/reference/stand_values.html" class="external-link">stand_basalArea</a></code>)
and the input map in the target location. Locations where the metric value in the map is missing are left unmodified.
Options for structural variables are the following:</p><ul><li><p><code>mean_tree_height</code>: Should contain values in cm. Corrects tree heights and diameters (assuming a constant diameter-height relationship).</p></li>
<li><p><code>dominant_tree_height</code>: Should contain values in cm. Corrects tree heights and diameters (assuming a constant diameter-height relationship).</p></li>
<li><p><code>tree_density</code>: Should contain values in individuals per hectare. Corrects tree density.</p></li>
<li><p><code>basal_area</code>: Should contain values in squared meters per hectare (m2/ha). Corrects tree density.</p></li>
<li><p><code>mean_shrub_height</code>: Should contain values in cm. Corrects shrub cover.</p></li>
</ul><p>Function <code>check_forest()</code> checks first that <code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">forest</a></code> objects are defined in "wildland" locations. Then, it looks for missing
data in tree or shrub attributes required for simulations. The function does not modify the data.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="create_landscape.html">create_landscape()</a></code>, <code><a href="soil_parametrization.html">add_soilgrids()</a></code>, <code><a href="https://emf-creaf.github.io/medfate/reference/forest_mergeTrees.html" class="external-link">forest_mergeTrees</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># See vignette 'Preparing inputs'</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Miquel De Cáceres, Aitor Améztegui, María González, Núria Aquilué, Daniel Caviedes-Voullième, Mario Morales-Hernández.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

